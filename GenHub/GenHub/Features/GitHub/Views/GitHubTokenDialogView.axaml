<Window xmlns="https://github.com/avaloniaui"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:vm="using:GenHub.Features.GitHub.ViewModels"
        xmlns:const="using:GenHub.Core.Constants"
        mc:Ignorable="d" d:DesignWidth="500" d:DesignHeight="450"
        x:Class="GenHub.Features.GitHub.Views.GitHubTokenDialogView"
        x:DataType="vm:GitHubTokenDialogViewModel"
        Title="{x:Static const:GitHubConstants.GitHubAuthenticationTitle}"
        Width="500"
        Height="450"
        WindowStartupLocation="CenterOwner"
        CanResize="False"
        SystemDecorations="BorderOnly">

    <Window.Resources>
        <!-- Theme-aware colors -->
        <SolidColorBrush x:Key="DialogBackground" Color="{DynamicResource SystemAltHighColor}"/>
        <SolidColorBrush x:Key="ContentBackground" Color="{DynamicResource SystemAltMediumColor}"/>
        <SolidColorBrush x:Key="BorderBrush" Color="{DynamicResource SystemBaseMediumColor}"/>
        <SolidColorBrush x:Key="AccentColor" Color="{DynamicResource SystemAccentColor}"/>
        <SolidColorBrush x:Key="ErrorColor" Color="{DynamicResource SystemErrorTextColor}"/>
        <SolidColorBrush x:Key="SuccessColor" Color="{DynamicResource SystemAccentColor}"/>
        <SolidColorBrush x:Key="TextPrimary" Color="{DynamicResource SystemBaseHighColor}"/>
        <SolidColorBrush x:Key="TextSecondary" Color="{DynamicResource SystemBaseMediumColor}"/>
    </Window.Resources>

    <Window.Styles>
        <Style Selector="Button.primary">
            <Setter Property="Background" Value="{StaticResource AccentColor}"/>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="CornerRadius" Value="4"/>
            <Setter Property="Padding" Value="16,8"/>
            <Setter Property="FontWeight" Value="Medium"/>
        </Style>

        <Style Selector="Button.primary:pointerover">
            <Setter Property="Background" Value="#106EBE"/>
        </Style>

        <Style Selector="Button.secondary">
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="Foreground" Value="{StaticResource TextPrimary}"/>
            <Setter Property="BorderBrush" Value="{StaticResource BorderBrush}"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="CornerRadius" Value="4"/>
            <Setter Property="Padding" Value="16,8"/>
        </Style>

        <Style Selector="Button.secondary:pointerover">
            <Setter Property="Background" Value="{StaticResource ContentBackground}"/>
        </Style>

        <Style Selector="TextBox">
            <Setter Property="Background" Value="{StaticResource ContentBackground}"/>
            <Setter Property="BorderBrush" Value="{StaticResource BorderBrush}"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="CornerRadius" Value="4"/>
            <Setter Property="Padding" Value="12,8"/>
            <Setter Property="Foreground" Value="{StaticResource TextPrimary}"/>
        </Style>

        <Style Selector="TextBox:focus">
            <Setter Property="BorderBrush" Value="{StaticResource AccentColor}"/>
            <Setter Property="BorderThickness" Value="2"/>
        </Style>
    </Window.Styles>

    <Design.DataContext>
        <vm:GitHubTokenDialogViewModel />
    </Design.DataContext>

    <Grid RowDefinitions="*,Auto" Background="{StaticResource DialogBackground}">
        <!-- Content -->
        <Border Grid.Row="0" Padding="32" Background="{StaticResource DialogBackground}">
            <Grid RowDefinitions="Auto,Auto,Auto,Auto,Auto,Auto,*">
                <!-- Header with Icon -->
                <StackPanel Grid.Row="0" Orientation="Horizontal" Spacing="12" Margin="0,0,0,20">
                    <TextBlock Text="ðŸ”‘" FontSize="24" VerticalAlignment="Center"/>
                    <TextBlock Text="{x:Static const:GitHubConstants.GitHubTokenHeaderLabel}"
                              FontSize="18"
                              FontWeight="SemiBold"
                              Foreground="{StaticResource TextPrimary}"
                              VerticalAlignment="Center" />
                </StackPanel>

                <TextBlock Grid.Row="1"
                          Text="{x:Static const:GitHubConstants.GitHubTokenDescription}"
                          TextWrapping="Wrap"
                          Foreground="{StaticResource TextSecondary}"
                          LineHeight="22"
                          Margin="0,0,0,16" />

                <!-- Token Input -->
                <StackPanel Grid.Row="2" Spacing="8" Margin="0,0,0,16">
                    <TextBlock Text="Personal Access Token:"
                              FontWeight="Medium"
                              Foreground="{StaticResource TextPrimary}"
                              FontSize="13"/>
                    <TextBox x:Name="TokenPasswordBox"
                            PasswordChar="*"
                            TextChanged="OnTokenPasswordChanged"
                            Watermark="{x:Static const:GitHubConstants.TokenWatermark}"
                            MinHeight="36"/>
                </StackPanel>

                <!-- Create PAT Link -->
                <StackPanel Grid.Row="3" Spacing="8" Margin="0,0,0,16">
                    <TextBlock Text="Don't have a Personal Access Token?" 
                              Foreground="{StaticResource TextSecondary}"
                              FontSize="12"/>
                    <Button Content="Create a GitHub Personal Access Token â†’" 
                            Command="{Binding OpenPatCreationCommand}"
                            Background="Transparent"
                            BorderThickness="0"
                            Padding="0"
                            HorizontalAlignment="Left"
                            Cursor="Hand"
                            ToolTip.Tip="Click to open GitHub PAT creation page">
                        <Button.Styles>
                            <Style Selector="Button">
                                <Setter Property="Foreground" Value="{StaticResource AccentColor}"/>
                                <Setter Property="FontSize" Value="12"/>
                            </Style>
                            <Style Selector="Button:pointerover">
                                <Setter Property="Foreground" Value="#106EBE"/>
                            </Style>
                        </Button.Styles>
                    </Button>
                </StackPanel>

                <!-- Validate Button -->
                <StackPanel Grid.Row="4" Orientation="Horizontal" Spacing="12" Margin="0,0,0,16">
                    <Button Content="{x:Static const:GitHubConstants.ValidateTokenButtonLabel}"
                            Command="{Binding ValidateTokenCommand}"
                            Classes="secondary"
                            IsEnabled="{Binding !IsValidating}" />
                </StackPanel>

                <!-- Loading/Progress Indicator -->
                <StackPanel Grid.Row="5" 
                           Orientation="Horizontal" 
                           Spacing="8" 
                           Margin="0,0,0,8"
                           IsVisible="{Binding IsValidating}">
                    <TextBlock Text="ðŸ”„" FontSize="14"/>
                    <TextBlock Text="Validating token..." 
                              Foreground="{StaticResource TextSecondary}"
                              FontSize="12"/>
                </StackPanel>

                <!-- Validation Message - More visible with background -->
                <Border Grid.Row="6"
                       Background="{Binding ValidationMessageBackgroundColor}"
                       BorderBrush="{Binding ValidationMessageColor}"
                       BorderThickness="1"
                       CornerRadius="4"
                       Padding="12,8"
                       Margin="0,4,0,20"
                       IsVisible="{Binding HasValidationMessage}">
                    <TextBlock Text="{Binding ValidationMessage}"
                              TextWrapping="Wrap"
                              FontSize="13"
                              FontWeight="Medium"
                              Foreground="{Binding ValidationMessageColor}" />
                </Border>
            </Grid>
        </Border>

        <!-- Buttons -->
        <Border Grid.Row="1"
                BorderBrush="{StaticResource BorderBrush}"
                BorderThickness="0,1,0,0"
                Background="{StaticResource ContentBackground}"
                Padding="32,16">
            <StackPanel Orientation="Horizontal" HorizontalAlignment="Right" Spacing="12">
                <Button Content="{x:Static const:GitHubConstants.CancelButtonLabel}"
                        Command="{Binding CancelCommand}"
                        Classes="secondary"
                        IsEnabled="{Binding !IsValidating}" />

                <Button Content="{x:Static const:GitHubConstants.SaveButtonLabel}"
                        Command="{Binding SaveCommand}"
                        Classes="primary" />
            </StackPanel>
        </Border>
    </Grid>
</Window>
