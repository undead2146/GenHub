<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:vm="clr-namespace:GenHub.Features.GameProfiles.ViewModels"
             xmlns:views="clr-namespace:GenHub.Features.GameProfiles.Views"
             xmlns:models="clr-namespace:GenHub.Core.Models.Enums;assembly=GenHub.Core"
             xmlns:conv="clr-namespace:GenHub.Infrastructure.Converters"
             xmlns:converters="clr-namespace:Avalonia.Data.Converters;assembly=Avalonia.Base"
             mc:Ignorable="d" d:DesignWidth="800" d:DesignHeight="1200"
             x:Class="GenHub.Features.GameProfiles.Views.GameProfileContentSettingsView"
             x:DataType="vm:GameProfileSettingsViewModel">

    <UserControl.Resources>
        <conv:ThemeBackgroundConverter x:Key="ThemeBackgroundConverter" />
        <conv:ThemeBorderConverter x:Key="ThemeBorderConverter" />
        <conv:ColorToBrushConverter x:Key="ColorToBrushConverter" />
        <conv:GameTypeDisplayConverter x:Key="GameTypeDisplayConverter" />
        <conv:ContentTypeDisplayConverter x:Key="ContentTypeDisplayConverter" />
        <conv:GameTypeShortDisplayConverter x:Key="GameTypeShortDisplayConverter" />
        <conv:InvertedBoolToVisibilityConverter x:Key="InvertedBoolToVisibilityConverter" />
        <conv:EqualityConverter x:Key="EqualityConverter" />
    </UserControl.Resources>



    <Grid>




        <!-- Content Area -->
        <!-- Content Area -->
        <ScrollViewer x:Name="ContentSettingsScrollViewer" Padding="0,24,0,80" VerticalScrollBarVisibility="Auto" HorizontalScrollBarVisibility="Disabled" BringIntoViewOnFocusChange="False">
            <StackPanel Spacing="0">

                <!-- Enabled Content Section -->
                <Control x:Name="SelectionSection" Height="1" Margin="0,-1,0,0" />
                <Border Classes="settings-card"
                        Background="{Binding ColorValue, Converter={StaticResource ThemeBackgroundConverter}, Mode=OneWay}"
                        BorderBrush="{Binding ColorValue, Converter={StaticResource ThemeBorderConverter}, Mode=OneWay}">
                    <StackPanel Spacing="16">
                        <Grid ColumnDefinitions="*,Auto">
                            <TextBlock Grid.Column="0" Classes="section-header" Text="Enabled Content" VerticalAlignment="Center" />
                            <Button Grid.Column="1" Content="âŸ³ Refresh"
                                    Command="{Binding LoadAvailableContentCommand}"
                                    Background="Transparent"
                                    Padding="12,6"
                                    FontSize="12"
                                    FontWeight="SemiBold"
                                    VerticalAlignment="Center" />
                        </Grid>

                        <Separator Background="#20FFFFFF" Height="1" />

                        <!-- Warning if no content -->
                        <Border Background="#30FF9800" CornerRadius="10" Padding="16" Margin="0,4,0,8"
                                IsVisible="{Binding EnabledContent.Count, Converter={x:Static converters:ObjectConverters.Equal}, ConverterParameter=0}">
                            <StackPanel Orientation="Horizontal" Spacing="12">
                                <TextBlock Text="âš ï¸" FontSize="18" />
                                <TextBlock Text="No content currently enabled. Add at least one Game Client or Executable to launch this profile."
                                           FontSize="13" Opacity="0.9" TextWrapping="Wrap" VerticalAlignment="Center" />
                            </StackPanel>
                        </Border>

                        <!-- Enabled content list -->
                        <ItemsControl ItemsSource="{Binding EnabledContent}">
                            <ItemsControl.ItemsPanel>
                                <ItemsPanelTemplate>
                                    <WrapPanel Orientation="Horizontal" HorizontalAlignment="Center" />
                                </ItemsPanelTemplate>
                            </ItemsControl.ItemsPanel>
                            <ItemsControl.ItemTemplate>
                                <DataTemplate>
                                    <Button Classes="content-card-btn"
                                            Command="{Binding $parent[ItemsControl].((vm:GameProfileSettingsViewModel)DataContext).DisableContentCommand}"
                                            CommandParameter="{Binding}"
                                            ToolTip.Tip="Remove from profile">
                                        <Grid ColumnDefinitions="*,Auto">
                                            <StackPanel Grid.Column="0" Spacing="6" HorizontalAlignment="Left" VerticalAlignment="Center">
                                                <TextBlock Text="{Binding DisplayName}" FontWeight="SemiBold" FontSize="13" TextTrimming="CharacterEllipsis" />
                                                <WrapPanel Orientation="Horizontal">
                                                    <Border Background="#20FF5252" BorderBrush="#FF5252" BorderThickness="1" CornerRadius="4" Padding="6,2" Margin="0,0,4,4"
                                                            IsVisible="{Binding Publisher, Converter={x:Static StringConverters.IsNotNullOrEmpty}}">
                                                        <TextBlock Text="{Binding Publisher}" FontSize="10" Foreground="#FF8A80" FontWeight="SemiBold" />
                                                    </Border>
                                                    <Border Background="#20FFFFFF" BorderBrush="#40FFFFFF" BorderThickness="1" CornerRadius="4" Padding="6,2" Margin="0,0,4,4">
                                                        <TextBlock Text="{Binding GameType, Converter={x:Static conv:GameTypeDisplayConverter.Instance}}" FontSize="10" Foreground="#E0E0E0" />
                                                    </Border>
                                                </WrapPanel>
                                            </StackPanel>
                                            <PathIcon Grid.Column="1" Data="M19,6.41L17.59,5L12,10.59L6.41,5L5,6.41L10.59,12L5,17.59L6.41,19L12,13.41L17.59,19L19,17.59L13.41,12L19,6.41Z"
                                                      Width="14" Height="14" Foreground="#60FFFFFF" VerticalAlignment="Center" Margin="12,0,0,0" />
                                        </Grid>
                                    </Button>
                                </DataTemplate>
                            </ItemsControl.ItemTemplate>
                        </ItemsControl>
                    </StackPanel>
                </Border>

                <!-- Discovery Section -->
                <Control x:Name="DiscoverySection" Height="1" Margin="0,-1,0,0" />
                <Border Classes="settings-card"
                        Background="{Binding ColorValue, Converter={StaticResource ThemeBackgroundConverter}, Mode=OneWay}"
                        BorderBrush="{Binding ColorValue, Converter={StaticResource ThemeBorderConverter}, Mode=OneWay}">
                    <StackPanel Spacing="20">
                        <TextBlock Classes="section-header" Text="Available Content" />

                        <!-- Filter Pills -->
                        <ItemsControl ItemsSource="{Binding VisibleFilters}">
                            <ItemsControl.ItemsPanel>
                                <ItemsPanelTemplate>
                                    <WrapPanel HorizontalAlignment="Center" />
                                </ItemsPanelTemplate>
                            </ItemsControl.ItemsPanel>
                            <ItemsControl.ItemTemplate>
                                <DataTemplate x:DataType="vm:GameProfileSettingsViewModel+FilterTypeInfo">
                                    <Button Classes="filter-pill"
                                            Classes.selected="{Binding ContentType, Converter={x:Static ObjectConverters.Equal}, ConverterParameter={Binding $parent[ItemsControl].((vm:GameProfileSettingsViewModel)DataContext).SelectedContentType}}"
                                            Command="{Binding $parent[ItemsControl].((vm:GameProfileSettingsViewModel)DataContext).SelectContentTypeFilterCommand}"
                                            CommandParameter="{Binding ContentType}">
                                        <StackPanel Orientation="Horizontal" Spacing="8">
                                            <PathIcon Data="{Binding IconData}" Width="16" Height="16" />
                                            <TextBlock Text="{Binding DisplayName}" FontSize="12" />
                                        </StackPanel>
                                    </Button>
                                </DataTemplate>
                            </ItemsControl.ItemTemplate>
                        </ItemsControl>

                        <!-- Filter Row -->
                        <Grid ColumnDefinitions="Auto,*" Margin="0,4,0,0">
                            <Button Grid.Column="0" Classes="filter-pill" Content="ðŸ“ Add Local Folder"
                                    Command="{Binding AddLocalContentCommand}"
                                    Padding="16,8" />

                            <StackPanel Grid.Column="1" Orientation="Horizontal" HorizontalAlignment="Right">
                                <Button Classes="filter-pill left" Content="Generals"
                                        Classes.selected="{Binding GameTypeFilter, Converter={x:Static ObjectConverters.Equal}, ConverterParameter={x:Static models:GameType.Generals}}"
                                        Command="{Binding SelectGameTypeFilterCommand}"
                                        CommandParameter="{x:Static models:GameType.Generals}" />
                                <Button Classes="filter-pill right" Content="Zero Hour"
                                        Classes.selected="{Binding GameTypeFilter, Converter={x:Static ObjectConverters.Equal}, ConverterParameter={x:Static models:GameType.ZeroHour}}"
                                        Command="{Binding SelectGameTypeFilterCommand}"
                                        CommandParameter="{x:Static models:GameType.ZeroHour}" />
                            </StackPanel>
                        </Grid>

                        <!-- List Background -->
                        <Border Background="#10000000" BorderBrush="#20FFFFFF" BorderThickness="1" CornerRadius="12" Padding="12">
                             <ItemsControl ItemsSource="{Binding AvailableContent}">
                                <ItemsControl.ItemsPanel>
                                    <ItemsPanelTemplate>
                                        <WrapPanel Orientation="Horizontal" HorizontalAlignment="Center" />
                                    </ItemsPanelTemplate>
                                </ItemsControl.ItemsPanel>
                                <ItemsControl.ItemTemplate>
                                    <DataTemplate>
                                        <Button Classes="content-card-btn"
                                                Command="{Binding $parent[ItemsControl].((vm:GameProfileSettingsViewModel)DataContext).EnableContentCommand}"
                                                CommandParameter="{Binding}"
                                                IsVisible="{Binding IsEnabled, Converter={x:Static conv:InvertedBoolToVisibilityConverter.Instance}}">
                                            <Grid ColumnDefinitions="*,Auto">
                                                 <StackPanel Grid.Column="0" Spacing="6" HorizontalAlignment="Left" VerticalAlignment="Center">
                                                     <TextBlock Text="{Binding DisplayName}" FontWeight="SemiBold" FontSize="13" TextTrimming="CharacterEllipsis" />
                                                     <WrapPanel Orientation="Horizontal">
                                                         <Border Background="#20FF6B6B" BorderBrush="#FF6B6B" BorderThickness="1" CornerRadius="4" Padding="6,2" Margin="0,0,4,4"
                                                                IsVisible="{Binding Publisher, Converter={x:Static StringConverters.IsNotNullOrEmpty}}">
                                                            <TextBlock Text="{Binding Publisher}" FontSize="10" Foreground="#FF8A80" FontWeight="SemiBold" />
                                                         </Border>
                                                         <Border Background="#20FFFFFF" BorderBrush="#40FFFFFF" BorderThickness="1" CornerRadius="4" Padding="6,2" Margin="0,0,4,4">
                                                             <TextBlock Text="{Binding GameType, Converter={x:Static conv:GameTypeShortDisplayConverter.Instance}}" FontSize="10" Foreground="#E0E0E0" />
                                                         </Border>
                                                     </WrapPanel>
                                                 </StackPanel>

                                                 <Button Grid.Column="1" Classes="delete-reveal-btn"
                                                         Command="{Binding $parent[ItemsControl].((vm:GameProfileSettingsViewModel)DataContext).DeleteContentCommand}"
                                                         CommandParameter="{Binding}"
                                                         Background="Transparent"
                                                         Padding="8" Margin="8,0,0,0">
                                                     <PathIcon Data="M9,3V4H4V6H5V19A2,2 0 0,0 7,21H17A2,2 0 0,0 19,19V6H20V4H15V3H9M7,6H17V19H7V6M9,8V17H11V8H9M13,8V17H15V8H13Z"
                                                               Foreground="#FF4444" Width="16" Height="16" />
                                                 </Button>
                                            </Grid>
                                        </Button>
                                    </DataTemplate>
                                </ItemsControl.ItemTemplate>
                            </ItemsControl>
                        </Border>
                    </StackPanel>
                </Border>

                <Panel Height="200" />
            </StackPanel>
        </ScrollViewer>
    </Grid>
</UserControl>
