<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:vm="clr-namespace:GenHub.Features.GameProfiles.ViewModels"
             xmlns:conv="clr-namespace:GenHub.Infrastructure.Converters"
             mc:Ignorable="d" d:DesignWidth="300" d:DesignHeight="400"
             x:Class="GenHub.Features.GameProfiles.Views.GameProfileCardView"
             x:DataType="vm:GameProfileItemViewModel">

    <UserControl.Resources>
        <conv:ContrastTextColorConverter x:Key="ContrastTextColorConverter" />
        <conv:StringToImageConverter x:Key="StringToImageConverter" />
        <conv:BoolToValueConverter x:Key="NotConverter" TrueValue="False" FalseValue="True" />
        <conv:ColorToBrushConverter x:Key="ColorToBrushConverter" />
        <conv:StringToColorConverter x:Key="StringToColorConverter" />
        <conv:ColorToShadowConverter x:Key="ColorToShadowConverter" />
    </UserControl.Resources>

    <UserControl.Styles>
        <!-- Card Container Style -->
        <Style Selector="Border.profile-card">
            <Setter Property="CornerRadius" Value="16" />
            <Setter Property="ClipToBounds" Value="True" />
            <Setter Property="Background" Value="#1A1A1A" />
            <Setter Property="Margin" Value="0 0 16 16" />
            <Setter Property="MinWidth" Value="280" />
            <Setter Property="MaxWidth" Value="360" />
            <Setter Property="MinHeight" Value="200" />
            <Setter Property="Height" Value="220" />
            <!-- Default shadow -->
            <Setter Property="BoxShadow" Value="0 4 12 0 #40000000" />
            <Setter Property="Transitions">
                <Setter.Value>
                    <Transitions>
                        <TransformOperationsTransition Property="RenderTransform" Duration="0:0:0.25" />
                        <BoxShadowsTransition Property="BoxShadow" Duration="0:0:0.25" />
                        <BrushTransition Property="BorderBrush" Duration="0:0:0.25" />
                    </Transitions>
                </Setter.Value>
            </Setter>
        </Style>

        <Style Selector="Border.profile-card[Tag=True]">
            <Setter Property="BorderThickness" Value="2" />
        </Style>

        <Style Selector="Border.profile-card:pointerover">
            <Setter Property="RenderTransform" Value="scale(1.05)" />
            <Setter Property="BoxShadow" Value="0 16 32 4 #80000000" />
            <Setter Property="Cursor" Value="Hand" />
            <Setter Property="ZIndex" Value="10" /> <!-- Pop out -->
        </Style>

        <!-- Hover Overlay Animation -->
        <Style Selector="Grid.hover-overlay">
            <Setter Property="Opacity" Value="0" />
            <Setter Property="Transitions">
                <Transitions>
                    <DoubleTransition Property="Opacity" Duration="0:0:0.2" />
                </Transitions>
            </Setter>
        </Style>

        <Style Selector="Border.profile-card:pointerover Grid.hover-overlay">
            <Setter Property="Opacity" Value="1" />
        </Style>

        <!-- Metadata Panel Animation -->
        <Style Selector="StackPanel.metadata-panel">
            <Setter Property="RenderTransform" Value="translateY(0)" />
            <Setter Property="Transitions">
                <Transitions>
                    <TransformOperationsTransition Property="RenderTransform" Duration="0:0:0.2" />
                </Transitions>
            </Setter>
        </Style>

        <!-- Move metadata up slightly on hover to make room/aesthetic -->
        <Style Selector="Border.profile-card:pointerover StackPanel.metadata-panel">
            <Setter Property="RenderTransform" Value="translateY(-4px)" />
        </Style>

        <!-- Launch Button Style -->
        <Style Selector="Button.launch-button">
            <Setter Property="Background" Value="#90FFFFFF" /> <!-- Glassy white -->
            <Setter Property="Foreground" Value="#1A1A1A" />
            <Setter Property="FontSize" Value="16" />
            <Setter Property="FontWeight" Value="Bold" />
            <Setter Property="CornerRadius" Value="24" />
            <Setter Property="Padding" Value="24,12" />
            <Setter Property="BorderThickness" Value="1" />
            <Setter Property="BorderBrush" Value="#FFFFFFFF" />
            <Setter Property="HorizontalAlignment" Value="Center" />
            <Setter Property="VerticalAlignment" Value="Center" />
            <Setter Property="RenderTransform" Value="scale(0.9)" />
            <Setter Property="Opacity" Value="0.4" />
            <Setter Property="Transitions">
                <Transitions>
                    <TransformOperationsTransition Property="RenderTransform" Duration="0:0:0.2" />
                    <DoubleTransition Property="Opacity" Duration="0:0:0.2" />
                    <BrushTransition Property="Background" Duration="0:0:0.2" />
                </Transitions>
            </Setter>
        </Style>

        <Style Selector="Border.profile-card:pointerover Button.launch-button">
            <Setter Property="RenderTransform" Value="scale(1)" />
            <Setter Property="Opacity" Value="1" />
        </Style>

        <Style Selector="Button.launch-button:pointerover">
            <Setter Property="Background" Value="#FFFFFFFF" />
            <Setter Property="RenderTransform" Value="scale(1.05)" />
        </Style>

        <Style Selector="Button.launch-button:pressed">
            <Setter Property="RenderTransform" Value="scale(0.95)" />
        </Style>

        <!-- Tools/Action Button Style -->
        <Style Selector="Button.tool-button, ToggleButton.tool-button">
            <Setter Property="Background" Value="#40000000" />
            <Setter Property="Foreground" Value="White" />
            <Setter Property="Width" Value="32" />
            <Setter Property="Height" Value="32" />
            <Setter Property="CornerRadius" Value="16" />
            <Setter Property="Padding" Value="0" />
            <Setter Property="BorderThickness" Value="1" />
            <Setter Property="BorderBrush" Value="#20FFFFFF" />
            <Setter Property="Margin" Value="4" />
            <Setter Property="HorizontalContentAlignment" Value="Center" />
            <Setter Property="VerticalContentAlignment" Value="Center" />
            <Setter Property="Transitions">
                <Transitions>
                    <BrushTransition Property="Background" Duration="0:0:0.2" />
                    <TransformOperationsTransition Property="RenderTransform" Duration="0:0:0.1" />
                </Transitions>
            </Setter>
        </Style>

        <Style Selector="Button.tool-button:pointerover, ToggleButton.tool-button:pointerover">
            <Setter Property="Background" Value="#80000000" />
            <Setter Property="BorderBrush" Value="#80FFFFFF" />
            <Setter Property="RenderTransform" Value="scale(1.1)" />
        </Style>

        <!-- Delete Button Specifics (Red Glassmorphism) -->
        <Style Selector="Button.delete-btn">
             <Setter Property="Background" Value="#20D32F2F" /> <!-- Subtle Red Tint -->
             <Setter Property="BorderBrush" Value="#60D32F2F" />
             <Setter Property="Foreground" Value="#FFEBEE" />
        </Style>
        <Style Selector="Button.delete-btn:pointerover">
            <Setter Property="Background" Value="#80D32F2F" /> <!-- Stronger Red on Hover -->
            <Setter Property="BorderBrush" Value="#FFD32F2F" />
            <Setter Property="Foreground" Value="White" />
        </Style>

        <Style Selector="Button.tool-button:pressed, ToggleButton.tool-button:pressed">
            <Setter Property="RenderTransform" Value="scale(0.9)" />
        </Style>

        <!-- Launch Button Theming -->
        <Style Selector="Button.launch-button">
            <Setter Property="BorderBrush" Value="{Binding ColorValue, Converter={StaticResource ColorToBrushConverter}}" />
            <Setter Property="Foreground" Value="White" />
        </Style>

        <Style Selector="Button.launch-button:pointerover">
            <Setter Property="Background" Value="#FFFFFFFF" />
            <Setter Property="Foreground" Value="{Binding ColorValue, Converter={StaticResource ColorToBrushConverter}}" />
            <Setter Property="RenderTransform" Value="scale(1.05)" />
        </Style>

        <!-- Ensure icon inside launch button inherits color on hover -->
        <Style Selector="Button.launch-button:pointerover PathIcon">
            <Setter Property="Foreground" Value="{Binding ColorValue, Converter={StaticResource ColorToBrushConverter}}" />
        </Style>

        <Style Selector="ToggleButton.tool-button:checked">
             <Setter Property="Background" Value="#80FFFFFF" /> <!-- Glassy checked state -->
             <Setter Property="Foreground" Value="#1A1A1A" />
        </Style>

        <!-- Badge Style -->
        <Style Selector="Border.badge">
            <Setter Property="Background" Value="#40000000" />
            <Setter Property="CornerRadius" Value="4" />
            <Setter Property="Padding" Value="6,2" />
            <Setter Property="Margin" Value="0,0,4,0" />
            <Setter Property="BorderThickness" Value="1" />
            <Setter Property="BorderBrush" Value="#20FFFFFF" />
        </Style>

        <Style Selector="TextBlock.badge-text">
            <Setter Property="FontSize" Value="10" />
            <Setter Property="FontWeight" Value="SemiBold" />
            <Setter Property="Foreground" Value="#E0E0E0" />
        </Style>

        <!-- Context Menu Style -->
        <Style Selector="ContextMenu">
            <Setter Property="Background" Value="#252525" />
            <Setter Property="BorderBrush" Value="#404040" />
            <Setter Property="CornerRadius" Value="8" />
        </Style>

        <!-- Running State Animation -->
        <Style Selector="Border.running-indicator">
            <Setter Property="BorderBrush" Value="{Binding ColorValue, Converter={StaticResource ColorToBrushConverter}}" />
            <Setter Property="BorderThickness" Value="2" />
        </Style>

        <!-- Hover Glow Animation (Dynamic Shadow) -->
        <Style Selector="Border.hover-glow">
            <Setter Property="Opacity" Value="0" />
            <Setter Property="Transitions">
                <Transitions>
                   <DoubleTransition Property="Opacity" Duration="0:0:0.2" />
                </Transitions>
            </Setter>
        </Style>
        <Style Selector="Border.profile-card:pointerover Border.hover-glow">
            <Setter Property="Opacity" Value="1" />
        </Style>

        <!-- Steam Toggle Button Specifics -->
        <Style Selector="ToggleButton.steam-toggle">
            <Setter Property="Background" Value="Transparent" />
            <Setter Property="BorderBrush" Value="Transparent" />
        </Style>

        <!-- Force transparency on the internal Avalonia presenter for all states -->
        <Style Selector="ToggleButton.steam-toggle /template/ ContentPresenter#PART_ContentPresenter">
            <Setter Property="Background" Value="Transparent" />
            <Setter Property="BorderBrush" Value="Transparent" />
        </Style>

        <!-- State: OFF (Unchecked) - Image is dimmed/transparent -->
        <Style Selector="ToggleButton.steam-toggle Image">
            <Setter Property="Opacity" Value="0.3" />
            <Setter Property="Transitions">
                <Transitions>
                    <DoubleTransition Property="Opacity" Duration="0:0:0.2" />
                </Transitions>
            </Setter>
        </Style>

        <!-- State: hover -->
        <Style Selector="ToggleButton.steam-toggle:pointerover Image">
            <Setter Property="Opacity" Value="0.6" />
        </Style>

        <!-- State: on (Checked) -->
        <Style Selector="ToggleButton.steam-toggle:checked Image">
            <Setter Property="Opacity" Value="1.0" />
        </Style>

        <Style Selector="ToggleButton.steam-toggle:checked /template/ ContentPresenter#PART_ContentPresenter">
            <Setter Property="Background" Value="Transparent" />
            <Setter Property="BorderBrush" Value="Transparent" />
        </Style>

    </UserControl.Styles>

    <!-- Main Card Container -->
    <Border Classes="profile-card"
            Margin="6"
            ClipToBounds="False"
            BorderBrush="{Binding ColorValue, Converter={StaticResource ColorToBrushConverter}, Mode=OneWay}"
            Tag="{Binding IsProcessRunning}">

        <!-- Interactive coloured shadow/border effect on hover/running handled via Styles + local bindings carefully -->

        <!-- Context Menu (Right Click) -->
        <Border.ContextMenu>
            <ContextMenu>
                <MenuItem Header="Launch"
                          Command="{Binding LaunchProfileCommand}"
                          IsVisible="{Binding CanLaunch}">
                    <MenuItem.Icon>
                        <PathIcon Data="M8,5.14V19.14L19,12.14L8,5.14Z" />
                    </MenuItem.Icon>
                </MenuItem>
                <Separator IsVisible="{Binding CanLaunch}" />
                <MenuItem Header="Edit Profile"
                          Command="{Binding EditProfileCommand}">
                    <MenuItem.Icon>
                        <PathIcon Data="M20.71,4.04C21.1,3.65 21.1,3 20.71,2.63L18.37,0.29C18,-.1 17.35,-.1 16.96,0.29L15.12,2.12L18.87,5.87M3,17.25V21H6.75L17.81,9.93L14.06,6.18L3,17.25Z" />
                    </MenuItem.Icon>
                </MenuItem>
                <MenuItem Header="Create Shortcut"
                          Command="{Binding CreateShortcutCommand}">
                    <MenuItem.Icon>
                        <PathIcon Data="M16,12V4H17V2H7V4H8V12L6,14V16H11.2V22H12.8V16H18V14L16,12M8.8,14L10,12.8V4H14V12.8L15.2,14H8.8Z" />
                    </MenuItem.Icon>
                </MenuItem>
                <Separator />
                <MenuItem Header="Delete Profile"
                          Command="{Binding DeleteProfileCommand}"
                          Foreground="#EF4444">
                    <MenuItem.Icon>
                        <PathIcon Data="M19,4H15.5L14.5,3H9.5L8.5,4H5V6H19M6,19A2,2 0 0,0 8,21H16A2,2 0 0,0 18,19V7H6V19Z" Foreground="#EF4444" />
                    </MenuItem.Icon>
                </MenuItem>
            </ContextMenu>
        </Border.ContextMenu>

        <!-- Clipping Container for Internal Content -->
        <!-- This ensures all children are strictly clipped to the rounded corners, preventing 'hard corners' -->
        <Border CornerRadius="16" ClipToBounds="True">
            <Grid>
                <!-- Background Image (Clipped) -->
                <!-- Margin 1px to prevent sub-pixel bleeding at edges -->
                <Border CornerRadius="16" ClipToBounds="True" Margin="1">
                     <Image Source="{Binding CoverImagePath, Converter={StaticResource StringToImageConverter}}"
                            Stretch="UniformToFill" />
                </Border>

                <!-- Dark Gradient Overlay -->
                <Border CornerRadius="16" Margin="1">
                    <Border.Background>
                        <LinearGradientBrush StartPoint="0%,0%" EndPoint="0%,100%">
                            <GradientStop Color="#20000000" Offset="0" />
                            <GradientStop Color="#80000000" Offset="0.6" /> <!-- Darker bottom for text contrast -->
                            <GradientStop Color="#F0000000" Offset="1" />
                        </LinearGradientBrush>
                    </Border.Background>
                </Border>

                <!-- Hover Glow Overlay (Dynamic Color & Strong Border) -->
                <!-- Margin increased to 0 to align with background, but verify clipping.
                     Actually, let's use Margin="-2" to make it bleed OUTWARD slightly if ZIndex is high, or 0 if contained.
                     The user reported missing borders (left/top). This usually means clipping.
                     Let's ensure the parent container has enough padding or this element has margin. -->
                <Border Classes="hover-glow" IsVisible="{Binding !IsProcessRunning}"
                        BorderBrush="{Binding ColorValue, Converter={StaticResource ColorToBrushConverter}}"
                        BorderThickness="4"
                        CornerRadius="16"
                        BoxShadow="{Binding ColorValue, Converter={StaticResource ColorToShadowConverter}}">
                    <!-- Inner tint for color pop -->
                     <Border.Background>
                        <SolidColorBrush Color="{Binding ColorValue, Converter={StaticResource StringToColorConverter}}" Opacity="0.1" />
                    </Border.Background>
                </Border>

                <!-- Color Tint Overlay -->
                <Border Opacity="0.25" IsVisible="{Binding !IsProcessRunning}" CornerRadius="16">
                    <Border.Background>
                        <SolidColorBrush Color="{Binding ColorValue, Converter={StaticResource StringToColorConverter}}" />
                    </Border.Background>
                </Border>

                <!-- Running State Active Overlay -->
                <Border IsVisible="{Binding IsProcessRunning}"
                        BorderBrush="{Binding ColorValue, Converter={StaticResource ColorToBrushConverter}}"
                        BorderThickness="2"
                        CornerRadius="16"
                        BoxShadow="{Binding ColorValue, Converter={StaticResource ColorToShadowConverter}}">
                    <Border.Background>
                         <SolidColorBrush Color="{Binding ColorValue, Converter={StaticResource StringToColorConverter}}" Opacity="0.15"/>
                    </Border.Background>
                </Border>

                <!-- Metadata Content (Bottom) -->
                <StackPanel Classes="metadata-panel" VerticalAlignment="Bottom" Margin="16">
                    <!-- Title and Icon -->
                    <Grid ColumnDefinitions="Auto, *">
                        <!-- Icon Container with Profile Color Border -->
                        <Border Grid.Column="0" Width="40" Height="40" CornerRadius="10" ClipToBounds="True" Margin="0,0,12,0"
                                Background="#30000000"
                                BorderBrush="{Binding ColorValue, Converter={StaticResource ColorToBrushConverter}}"
                                BorderThickness="1.5">
                            <Image Source="{Binding IconPath, Converter={StaticResource StringToImageConverter}}"
                                   Stretch="Uniform" Margin="4"/>
                        </Border>

                        <StackPanel Grid.Column="1" VerticalAlignment="Center">
                            <TextBlock Text="{Binding Name}"
                                       Foreground="White"
                                       FontWeight="Bold"
                                       FontSize="16"
                                       TextTrimming="CharacterEllipsis" />
                            <TextBlock Text="{Binding Description}"
                                       Foreground="#B0B0B0"
                                       FontSize="11"
                                       TextTrimming="CharacterEllipsis" />
                        </StackPanel>
                    </Grid>

                    <!-- Badges -->
                    <WrapPanel Margin="48,8,0,0"> <!-- Indent to align with text -->
                        <Border Classes="badge" IsVisible="{Binding GameVersion, Converter={x:Static StringConverters.IsNotNullOrEmpty}}">
                            <TextBlock Classes="badge-text" Text="{Binding GameVersion}" />
                        </Border>

                        <Border Classes="badge" IsVisible="{Binding Publisher, Converter={x:Static StringConverters.IsNotNullOrEmpty}}">
                            <TextBlock Classes="badge-text" Text="{Binding Publisher}" />
                        </Border>

                        <Border Classes="badge" IsVisible="{Binding RunAsAdmin}" BorderBrush="#EF4444" Background="#20EF4444">
                            <TextBlock Classes="badge-text" Text="ADMIN" Foreground="#EF4444" />
                        </Border>
                    </WrapPanel>
                </StackPanel>


                <!-- Hover Interaction Overlay -->
                <Grid Classes="hover-overlay" IsVisible="{Binding !IsProcessRunning}">

                    <!-- Tint Darken on Hover -->
                    <Border Background="#30000000" CornerRadius="16" />

                    <!-- Launch Button Center -->
                    <Button Classes="launch-button"
                            Content="LAUNCH"
                            Command="{Binding LaunchProfileCommand}"
                            IsVisible="{Binding CanLaunch}">
                        <Button.Content>
                            <StackPanel Orientation="Horizontal" Spacing="8">
                                <PathIcon Data="M8,5.14V19.14L19,12.14L8,5.14Z" Width="14" Height="14" />
                                <TextBlock Text="LAUNCH" VerticalAlignment="Center" FontWeight="Bold"/>
                            </StackPanel>
                        </Button.Content>
                    </Button>

                    <!-- Top Right Tools (Expanded) -->
                    <StackPanel Orientation="Horizontal" HorizontalAlignment="Right" VerticalAlignment="Top" Margin="8">
                        <!-- Steam Toggle -->
                        <ToggleButton Classes="tool-button steam-toggle"
                                      IsChecked="{Binding UseSteamLaunch}"
                                      ToolTip.Tip="Toggle Steam Integration"
                                      IsVisible="{Binding IsSteamInstallation}"
                                      Background="Transparent"
                                      Command="{Binding $parent[ItemsControl].((vm:GameProfileLauncherViewModel)DataContext).ToggleSteamLaunchCommand}"
                                      CommandParameter="{Binding}">
                            <Image Source="/Assets/Icons/steam-icon.png"
                                 Width="20" Height="20" />                    </ToggleButton>

                        <!-- Edit Button -->
                        <Button Classes="tool-button"
                                Command="{Binding EditProfileCommand}"
                                ToolTip.Tip="Edit Profile">
                            <PathIcon Data="M20.71,4.04C21.1,3.65 21.1,3 20.71,2.63L18.37,0.29C18,-.1 17.35,-.1 16.96,0.29L15.12,2.12L18.87,5.87M3,17.25V21H6.75L17.81,9.93L14.06,6.18L3,17.25Z"
                                      Width="14" Height="14" />
                        </Button>

                        <!-- Create Shortcut -->
                        <Button Classes="tool-button"
                                Command="{Binding CreateShortcutCommand}"
                                ToolTip.Tip="Create Desktop Shortcut">
                            <PathIcon Data="M16,12V4H17V2H7V4H8V12L6,14V16H11.2V22H12.8V16H18V14L16,12M8.8,14L10,12.8V4H14V12.8L15.2,14H8.8Z"
                                      Width="14" Height="14" />
                        </Button>

                        <!-- Delete Button -->
                        <Button Classes="tool-button delete-btn"
                                Command="{Binding DeleteProfileCommand}"
                                Foreground="#EF4444"
                                ToolTip.Tip="Delete Profile">
                            <PathIcon Data="M19,4H15.5L14.5,3H9.5L8.5,4H5V6H19M6,19A2,2 0 0,0 8,21H16A2,2 0 0,0 18,19V7H6V19Z"
                                      Width="14" Height="14" />
                        </Button>
                    </StackPanel>
                </Grid>

                <!-- Running State Overlay (Always interactions when running) -->
                <Grid IsVisible="{Binding IsProcessRunning}">
                    <!-- Stop Button Center -->
                    <Button Classes="launch-button"
                            Command="{Binding $parent[ItemsControl].((vm:GameProfileLauncherViewModel)DataContext).StopProfileCommand}"
                            CommandParameter="{Binding}"
                            Background="#CCEF4444"
                            BorderBrush="#EF4444"
                            Foreground="White"
                            Opacity="1"
                            RenderTransform="scale(1)">
                        <Button.Transitions>
                            <Transitions />
                        </Button.Transitions>
                        <Button.Styles>
                             <Style Selector="Button:pointerover">
                                 <Setter Property="Background" Value="#EFEF4444" />
                             </Style>
                        </Button.Styles>
                        <StackPanel Orientation="Horizontal" Spacing="8">
                            <PathIcon Data="M18,18H6V6H18V18Z" Width="14" Height="14" Foreground="White" />
                            <TextBlock Text="STOP" VerticalAlignment="Center" Foreground="White"/>
                        </StackPanel>
                    </Button>

                    <!-- "Playing" Indicator Top Left -->
                    <Border HorizontalAlignment="Left" VerticalAlignment="Top" Margin="12"
                            CornerRadius="4" Padding="8,4">
                         <!-- Note: ConverterParameter doesn't work with StringToColorConverter like that unless we update logic,
                              but ColorToBrush handles opacity via parameter? ColorToBrush uses parameters for opacity if coded.
                              Let's assume default opacity for now. -->
                         <Border.Background>
                             <SolidColorBrush Color="{Binding ColorValue, Converter={StaticResource StringToColorConverter}}" Opacity="0.9" />
                         </Border.Background>
                        <StackPanel Orientation="Horizontal" Spacing="4">
                             <Ellipse Width="8" Height="8" Fill="White">
                                 <Ellipse.Styles>
                                     <Style Selector="Ellipse">
                                         <Style.Animations>
                                             <Animation Duration="0:0:1" IterationCount="Infinite">
                                                 <KeyFrame Cue="0%">
                                                     <Setter Property="Opacity" Value="1.0"/>
                                                 </KeyFrame>
                                                 <KeyFrame Cue="50%">
                                                     <Setter Property="Opacity" Value="0.4"/>
                                                 </KeyFrame>
                                                 <KeyFrame Cue="100%">
                                                     <Setter Property="Opacity" Value="1.0"/>
                                                 </KeyFrame>
                                             </Animation>
                                         </Style.Animations>
                                     </Style>
                                 </Ellipse.Styles>
                             </Ellipse>
                             <TextBlock Text="RUNNING" FontSize="10" FontWeight="Bold" Foreground="White" VerticalAlignment="Center"/>
                        </StackPanel>
                    </Border>
                </Grid>



                <!-- User Data Confirmation Overlay (Preserved from original) -->
                <Grid IsVisible="{Binding ShowUserDataConfirmation}"
                      Background="#E6101010"
                      ClipToBounds="True">
                     <!-- Preserved content logic, simplified layout -->
                     <StackPanel VerticalAlignment="Center" HorizontalAlignment="Center" Spacing="16" Margin="16">
                         <PathIcon Data="M12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12A10,10 0 0,0 12,2M11,17H13V11H11V17M11,9H13V7H11V9Z"
                                   Width="32" Height="32" Foreground="#F59E0B" HorizontalAlignment="Center"/>

                         <TextBlock Text="User Data Conflict" FontWeight="Bold" FontSize="16" Foreground="White" HorizontalAlignment="Center"/>
                         <TextBlock Text="{Binding UserDataConfirmationMessage}"
                                    TextWrapping="Wrap" TextAlignment="Center" Foreground="#B0B0B0" FontSize="12"/>

                         <StackPanel Spacing="8">
                             <Button Content="Keep Data" Classes="launch-button"
                                     Command="{Binding $parent[ItemsControl].((vm:GameProfileLauncherViewModel)DataContext).ConfirmUserDataKeepCommand}"
                                     CommandParameter="{Binding}"
                                     Background="#22C55E" BorderBrush="#22C55E" Foreground="White"
                                     FontSize="12" Padding="16,8" Opacity="1" RenderTransform="scale(1)"/>

                             <Grid ColumnDefinitions="*,*">
                                <Button Grid.Column="0" Content="Remove" Classes="launch-button"
                                         Command="{Binding $parent[ItemsControl].((vm:GameProfileLauncherViewModel)DataContext).ConfirmUserDataRemoveCommand}"
                                         CommandParameter="{Binding}"
                                         Background="#EF4444" BorderBrush="#EF4444" Foreground="White"
                                         FontSize="12" Padding="8,8" Margin="0,0,4,0" Opacity="1" RenderTransform="scale(1)"/>

                                <Button Grid.Column="1" Content="Cancel" Classes="launch-button"
                                         Command="{Binding $parent[ItemsControl].((vm:GameProfileLauncherViewModel)DataContext).CancelUserDataConfirmationCommand}"
                                         CommandParameter="{Binding}"
                                         Background="#4B5563" BorderBrush="#4B5563" Foreground="White"
                                         FontSize="12" Padding="8,8" Margin="4,0,0,0" Opacity="1" RenderTransform="scale(1)"/>
                             </Grid>
                         </StackPanel>
                     </StackPanel>
                </Grid>
            </Grid>
        </Border>
    </Border>
</UserControl>
