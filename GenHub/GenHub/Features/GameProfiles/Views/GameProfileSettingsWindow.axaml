<Window xmlns="https://github.com/avaloniaui"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:vm="clr-namespace:GenHub.Features.GameProfiles.ViewModels"
        xmlns:views="clr-namespace:GenHub.Features.GameProfiles.Views"
        xmlns:models="clr-namespace:GenHub.Core.Models.Enums;assembly=GenHub.Core"
        xmlns:conv="clr-namespace:GenHub.Infrastructure.Converters"
        mc:Ignorable="d" d:DesignWidth="750" d:DesignHeight="700"
        x:Class="GenHub.Features.GameProfiles.Views.GameProfileSettingsWindow"
        x:DataType="vm:GameProfileSettingsViewModel"
        Title="Profile Settings"
        Width="750" Height="700"
        MinWidth="600" MinHeight="550"
        CanResize="True"
        WindowStartupLocation="CenterOwner"
        Background="#0F0F0F"
        Icon="avares://GenHub/Assets/Icons/generalshub-icon.png">
    
    <Window.Resources>
        <conv:ContrastTextColorConverter x:Key="ContrastTextColorConverter" />
        <conv:ColorToBrushConverter x:Key="ColorToBrushConverter" />
        <conv:BoolToColorConverter x:Key="BoolToColorConverter" />
        <conv:BoolToStatusColorConverter x:Key="BoolToStatusColorConverter" />
        <conv:StringToImageConverter x:Key="StringToImageConverter" />
        <conv:NotNullConverter x:Key="NotNullConverter" />
        <conv:NotNullOrEmptyConverter x:Key="NotNullOrEmptyConverter" />
        <conv:NullSafePropertyConverter x:Key="NullSafeConverter" />
        <conv:NullToVisibilityConverter x:Key="NullToVisibilityConverter" />
        <conv:BoolToVisibilityConverter x:Key="BoolToVisibilityConverter" />
        <conv:InvertedBoolToVisibilityConverter x:Key="InvertedBoolToVisibilityConverter" />
    </Window.Resources>

    <Window.Styles>
        <!-- Modern tab style -->
        <Style Selector="TabItem">
            <Setter Property="FontSize" Value="13" />
            <Setter Property="FontWeight" Value="SemiBold" />
            <Setter Property="Padding" Value="16,10" />
            <Setter Property="Margin" Value="0,0,4,0" />
        </Style>
        
        <!-- Section card style -->
        <Style Selector="Border.section-card">
            <Setter Property="Background" Value="#18FFFFFF" />
            <Setter Property="BorderBrush" Value="#25FFFFFF" />
            <Setter Property="BorderThickness" Value="1" />
            <Setter Property="CornerRadius" Value="10" />
            <Setter Property="Padding" Value="16" />
            <Setter Property="Margin" Value="0,0,0,12" />
        </Style>
        
        <!-- Section title -->
        <Style Selector="TextBlock.section-title">
            <Setter Property="FontSize" Value="15" />
            <Setter Property="FontWeight" Value="SemiBold" />
            <Setter Property="Margin" Value="0,0,0,12" />
        </Style>
        
        <!-- Form field -->
        <Style Selector="StackPanel.form-field">
            <Setter Property="Margin" Value="0,0,0,12" />
        </Style>
        
        <!-- Form label -->
        <Style Selector="TextBlock.form-label">
            <Setter Property="Margin" Value="0,0,0,6" />
            <Setter Property="Opacity" Value="0.85" />
            <Setter Property="FontSize" Value="13" />
            <Setter Property="FontWeight" Value="Medium" />
        </Style>
        
        <!-- Input fields -->
        <Style Selector="TextBox, ComboBox">
            <Setter Property="MinHeight" Value="36" />
            <Setter Property="Background" Value="#15FFFFFF" />
            <Setter Property="BorderBrush" Value="#30FFFFFF" />
            <Setter Property="CornerRadius" Value="6" />
        </Style>
        
        <!-- Compact color button -->
        <Style Selector="Button.color-btn">
            <Setter Property="Width" Value="28" />
            <Setter Property="Height" Value="28" />
            <Setter Property="Margin" Value="0,0,6,6" />
            <Setter Property="Padding" Value="0" />
            <Setter Property="CornerRadius" Value="14" />
            <Setter Property="Cursor" Value="Hand" />
        </Style>
        
        <!-- Content action buttons -->
        <Style Selector="Button.btn-add">
            <Setter Property="Background" Value="#1976D2" />
            <Setter Property="Foreground" Value="White" />
            <Setter Property="CornerRadius" Value="5" />
            <Setter Property="Padding" Value="10,5" />
            <Setter Property="FontSize" Value="11" />
            <Setter Property="FontWeight" Value="SemiBold" />
            <Setter Property="Cursor" Value="Hand" />
        </Style>
        <Style Selector="Button.btn-add:pointerover /template/ ContentPresenter">
            <Setter Property="Background" Value="#1565C0" />
        </Style>
        
        <Style Selector="Button.btn-remove">
            <Setter Property="Background" Value="#C62828" />
            <Setter Property="Foreground" Value="White" />
            <Setter Property="CornerRadius" Value="5" />
            <Setter Property="Padding" Value="8,5" />
            <Setter Property="FontSize" Value="11" />
            <Setter Property="FontWeight" Value="SemiBold" />
            <Setter Property="Cursor" Value="Hand" />
        </Style>
        <Style Selector="Button.btn-remove:pointerover /template/ ContentPresenter">
            <Setter Property="Background" Value="#B71C1C" />
        </Style>
        
        <!-- Content filter pills -->
        <Style Selector="Button.filter-pill">
            <Setter Property="Background" Value="#18FFFFFF" />
            <Setter Property="Foreground" Value="White" />
            <Setter Property="BorderBrush" Value="#30FFFFFF" />
            <Setter Property="BorderThickness" Value="1" />
            <Setter Property="CornerRadius" Value="8" />
            <Setter Property="Padding" Value="12,8" />
            <Setter Property="MinWidth" Value="100" />
            <Setter Property="Cursor" Value="Hand" />
            <Setter Property="HorizontalContentAlignment" Value="Center" />
        </Style>
        <Style Selector="Button.filter-pill:pointerover /template/ ContentPresenter">
            <Setter Property="Background" Value="#25FFFFFF" />
        </Style>
        <Style Selector="Button.filter-pill.selected">
            <Setter Property="Background" Value="#1976D2" />
            <Setter Property="BorderBrush" Value="#42A5F5" />
        </Style>
    </Window.Styles>

    <Grid RowDefinitions="Auto,*">
        <!-- Compact Header -->
        <Border Grid.Row="0" 
                Background="{Binding ColorValue, Converter={StaticResource ColorToBrushConverter}, Mode=OneWay}" 
                CornerRadius="0,0,16,16" 
                Height="70">
            <Grid ColumnDefinitions="Auto,*,Auto" Margin="16,0">
                <!-- Profile Icon -->
                <Border Grid.Column="0"
                        Width="44" Height="44"
                        Background="#25FFFFFF"
                        CornerRadius="22"
                        ClipToBounds="True">
                    <Image Source="{Binding IconPath, Mode=OneWay, Converter={StaticResource StringToImageConverter}}"
                           Width="44" Height="44"
                           Stretch="UniformToFill" />
                </Border>

                <!-- Profile Info -->
                <StackPanel Grid.Column="1" VerticalAlignment="Center" Margin="12,0,0,0">
                    <TextBlock Text="{Binding Name, Mode=OneWay, FallbackValue='New Profile'}"
                               Foreground="{Binding ColorValue, Converter={StaticResource ContrastTextColorConverter}, Mode=OneWay}"
                               FontSize="16"
                               FontWeight="SemiBold" />
                    <TextBlock Text="{Binding Description, Mode=OneWay, FallbackValue=''}"
                               Foreground="{Binding ColorValue, Converter={StaticResource ContrastTextColorConverter}, Mode=OneWay}"
                               Opacity="0.75"
                               FontSize="11"
                               MaxWidth="300"
                               TextTrimming="CharacterEllipsis" />
                </StackPanel>

                <!-- Action Buttons -->
                <StackPanel Grid.Column="2" Orientation="Horizontal" Spacing="8" VerticalAlignment="Center">
                    <Button Content="Cancel" 
                            Command="{Binding ExecuteCancelCommand}"  
                            Background="#25000000"
                            Foreground="{Binding ColorValue, Converter={StaticResource ContrastTextColorConverter}, Mode=OneWay}"
                            BorderBrush="{Binding ColorValue, Converter={StaticResource ContrastTextColorConverter}, Mode=OneWay}"
                            BorderThickness="1"
                            Width="80" Height="34"
                            CornerRadius="17"
                            FontWeight="Medium"
                            FontSize="12"
                            HorizontalContentAlignment="Center"
                            VerticalContentAlignment="Center" />
                    
                    <Button Content="ğŸ’¾ Save" 
                            Command="{Binding SaveCommand}">
                        <Button.Background>
                            <Binding Path="ColorValue" Converter="{StaticResource ContrastTextColorConverter}" Mode="OneWay" />
                        </Button.Background>
                        <Button.Foreground>
                            <Binding Path="ColorValue" Converter="{StaticResource ColorToBrushConverter}" Mode="OneWay" />
                        </Button.Foreground>
                        <Button.Width>90</Button.Width>
                        <Button.Height>34</Button.Height>
                        <Button.CornerRadius>17</Button.CornerRadius>
                        <Button.FontWeight>Bold</Button.FontWeight>
                        <Button.FontSize>13</Button.FontSize>
                        <Button.HorizontalContentAlignment>Center</Button.HorizontalContentAlignment>
                        <Button.VerticalContentAlignment>Center</Button.VerticalContentAlignment>
                        <ToolTip.Tip>Save profile changes (Ctrl+S)</ToolTip.Tip>
                    </Button>
                    
                    <Button Command="{Binding RandomizeColorCommand}"
                            Background="#25000000"
                            BorderBrush="{Binding ColorValue, Converter={StaticResource ContrastTextColorConverter}, Mode=OneWay}"
                            BorderThickness="1"
                            Width="34" Height="34"
                            CornerRadius="17"
                            Padding="0"
                            ToolTip.Tip="Randomize color">
                        <PathIcon
                            Data="M17.65,6.35C16.2,4.9 14.21,4 12,4A8,8 0 0,0 4,12A8,8 0 0,0 12,20C15.73,20 18.84,17.45 19.73,14H17.65C16.83,16.33 14.61,18 12,18A6,6 0 0,1 6,12A6,6 0 0,1 12,6C13.66,6 15.14,6.69 16.22,7.78L13,11H20V4L17.65,6.35Z"
                            Width="16" Height="16"
                            Foreground="{Binding ColorValue, Converter={StaticResource ContrastTextColorConverter}, Mode=OneWay}" />
                    </Button>
                </StackPanel>
            </Grid>
        </Border>

        <!-- Main Content with Tabs -->
        <TabControl Grid.Row="1" Margin="12,12,12,12">
            
            <!-- Profile Tab -->
            <TabItem Header="âš™ï¸ Profile">
                <ScrollViewer Padding="4">
                    <StackPanel Spacing="0">
                        
                        <!-- Basic Info Section -->
                        <Border Classes="section-card">
                            <StackPanel>
                                <TextBlock Classes="section-title" Text="Basic Information" />
                                
                                <StackPanel Classes="form-field">
                                    <TextBlock Classes="form-label" Text="Profile Name" />
                                    <TextBox Text="{Binding Name, Mode=TwoWay}" 
                                             Watermark="Enter profile name" />
                                </StackPanel>

                                <StackPanel Classes="form-field">
                                    <TextBlock Classes="form-label" Text="Description" />
                                    <TextBox Text="{Binding Description, Mode=TwoWay}" 
                                             Watermark="Optional description" 
                                             Height="50" 
                                             AcceptsReturn="True" 
                                             TextWrapping="Wrap" />
                                </StackPanel>
                            </StackPanel>
                        </Border>
                        
                        <!-- Launch Options Section -->
                        <Border Classes="section-card">
                            <StackPanel>
                                <TextBlock Classes="section-title" Text="Launch Options" />
                                
                                <StackPanel Classes="form-field">
                                    <TextBlock Classes="form-label" Text="Workspace Strategy" />
                                    <ComboBox ItemsSource="{x:Static vm:GameProfileSettingsViewModel.AvailableWorkspaceStrategies}"
                                              SelectedItem="{Binding SelectedWorkspaceStrategy}"
                                              HorizontalAlignment="Stretch">
                                        <ComboBox.ItemTemplate>
                                            <DataTemplate>
                                                <TextBlock Text="{Binding .}" />
                                            </DataTemplate>
                                        </ComboBox.ItemTemplate>
                                    </ComboBox>
                                    <TextBlock FontSize="11" Opacity="0.6" Margin="0,4,0,0" TextWrapping="Wrap">
                                        <TextBlock.Text>
                                            <MultiBinding StringFormat="{}{0}">
                                                <Binding Path="SelectedWorkspaceStrategy" />
                                            </MultiBinding>
                                        </TextBlock.Text>
                                    </TextBlock>
                                </StackPanel>

                                <StackPanel Classes="form-field">
                                    <TextBlock Classes="form-label" Text="Command Line Arguments" />
                                    <TextBox Text="{Binding CommandLineArguments, Mode=TwoWay}" 
                                             Watermark="-win -quicklaunch" />
                                    <TextBlock Text="Optional arguments passed to the game executable"
                                               FontSize="11" Opacity="0.6" Margin="0,4,0,0" />
                                </StackPanel>
                            </StackPanel>
                        </Border>
                        
                        <!-- Theme Section -->
                        <Border Classes="section-card">
                            <StackPanel>
                                <TextBlock Classes="section-title" Text="Theme Color" />
                                <WrapPanel>
                                    <Button Classes="color-btn" Background="#D32F2F" Command="{Binding SelectThemeColorCommand}" CommandParameter="#D32F2F" />
                                    <Button Classes="color-btn" Background="#C2185B" Command="{Binding SelectThemeColorCommand}" CommandParameter="#C2185B" />
                                    <Button Classes="color-btn" Background="#7B1FA2" Command="{Binding SelectThemeColorCommand}" CommandParameter="#7B1FA2" />
                                    <Button Classes="color-btn" Background="#512DA8" Command="{Binding SelectThemeColorCommand}" CommandParameter="#512DA8" />
                                    <Button Classes="color-btn" Background="#303F9F" Command="{Binding SelectThemeColorCommand}" CommandParameter="#303F9F" />
                                    <Button Classes="color-btn" Background="#1976D2" Command="{Binding SelectThemeColorCommand}" CommandParameter="#1976D2" />
                                    <Button Classes="color-btn" Background="#0288D1" Command="{Binding SelectThemeColorCommand}" CommandParameter="#0288D1" />
                                    <Button Classes="color-btn" Background="#0097A7" Command="{Binding SelectThemeColorCommand}" CommandParameter="#0097A7" />
                                    <Button Classes="color-btn" Background="#00796B" Command="{Binding SelectThemeColorCommand}" CommandParameter="#00796B" />
                                    <Button Classes="color-btn" Background="#388E3C" Command="{Binding SelectThemeColorCommand}" CommandParameter="#388E3C" />
                                    <Button Classes="color-btn" Background="#689F38" Command="{Binding SelectThemeColorCommand}" CommandParameter="#689F38" />
                                    <Button Classes="color-btn" Background="#FFA000" Command="{Binding SelectThemeColorCommand}" CommandParameter="#FFA000" />
                                    <Button Classes="color-btn" Background="#E64A19" Command="{Binding SelectThemeColorCommand}" CommandParameter="#E64A19" />
                                    <Button Classes="color-btn" Background="#BD5A0F" Command="{Binding SelectThemeColorCommand}" CommandParameter="#BD5A0F" ToolTip.Tip="Generals" />
                                    <Button Classes="color-btn" Background="#2D4963" Command="{Binding SelectThemeColorCommand}" CommandParameter="#2D4963" ToolTip.Tip="Zero Hour" />
                                </WrapPanel>
                            </StackPanel>
                        </Border>
                        
                    </StackPanel>
                </ScrollViewer>
            </TabItem>

            <!-- Content Tab -->
            <TabItem Header="ğŸ“¦ Content">
                <ScrollViewer Padding="4">
                    <StackPanel Spacing="0">
                        
                        <!-- Enabled Content Section -->
                        <Border Classes="section-card">
                            <StackPanel>
                                <Grid ColumnDefinitions="*,Auto">
                                    <TextBlock Grid.Column="0" Classes="section-title" Text="Enabled Content" Margin="0" />
                                    <Button Grid.Column="1" Content="âŸ³ Refresh" 
                                            Command="{Binding LoadAvailableContentCommand}"
                                            Background="Transparent"
                                            Padding="8,4"
                                            FontSize="11"
                                            VerticalAlignment="Top" />
                                </Grid>
                                
                                <!-- Warning if no content -->
                                <Border Background="#30FF9800" CornerRadius="6" Padding="12" Margin="0,4,0,8"
                                        IsVisible="{Binding EnabledContent.Count, Converter={x:Static ObjectConverters.Equal}, ConverterParameter=0}">
                                    <StackPanel Orientation="Horizontal" Spacing="8">
                                        <TextBlock Text="âš ï¸" FontSize="14" />
                                        <TextBlock Text="No content enabled. Add at least one Game Installation to launch this profile."
                                                   FontSize="12" Opacity="0.9" TextWrapping="Wrap" VerticalAlignment="Center" />
                                    </StackPanel>
                                </Border>
                                
                                <!-- Enabled content list -->
                                <ItemsControl ItemsSource="{Binding EnabledContent}">
                                    <ItemsControl.ItemTemplate>
                                        <DataTemplate>
                                            <Border Background="#12FFFFFF" CornerRadius="6" Padding="10" Margin="0,0,0,6">
                                                <Grid ColumnDefinitions="*,Auto">
                                                    <StackPanel Grid.Column="0" Spacing="4">
                                                        <TextBlock Text="{Binding DisplayName}" FontWeight="SemiBold" FontSize="13" />
                                                        <StackPanel Orientation="Horizontal" Spacing="6">
                                                            <Border Background="#FF6B6B" CornerRadius="3" Padding="5,2"
                                                                    IsVisible="{Binding Publisher, Converter={x:Static StringConverters.IsNotNullOrEmpty}}">
                                                                <TextBlock Text="{Binding Publisher}" FontSize="10" Foreground="White" FontWeight="SemiBold" />
                                                            </Border>
                                                            <Border Background="{Binding GameType, Converter={x:Static conv:GameTypeToBrushConverter.Instance}}" CornerRadius="3" Padding="5,2">
                                                                <TextBlock Text="{Binding GameType, Converter={x:Static conv:GameTypeDisplayConverter.Instance}}" FontSize="10" Foreground="White" />
                                                            </Border>
                                                            <Border Background="#757575" CornerRadius="3" Padding="5,2">
                                                                <TextBlock Text="{Binding ContentType, Converter={x:Static conv:ContentTypeDisplayConverter.Instance}}" FontSize="10" Foreground="White" />
                                                            </Border>
                                                        </StackPanel>
                                                    </StackPanel>
                                                    <Button Grid.Column="1" Content="âœ•" Classes="btn-remove"
                                                            Command="{Binding $parent[ItemsControl].((vm:GameProfileSettingsViewModel)DataContext).DisableContentCommand}"
                                                            CommandParameter="{Binding}"
                                                            VerticalAlignment="Center" />
                                                </Grid>
                                            </Border>
                                        </DataTemplate>
                                    </ItemsControl.ItemTemplate>
                                </ItemsControl>
                            </StackPanel>
                        </Border>
                        
                        <!-- Add Content Section -->
                        <Border Classes="section-card">
                            <StackPanel>
                                <TextBlock Classes="section-title" Text="Add Content" />
                                
                                <!-- Content type filter pills -->
                                <WrapPanel Margin="0,0,0,12">
                                    <Button Classes="filter-pill" Margin="0,0,8,8"
                                            Classes.selected="{Binding SelectedContentType, Converter={x:Static ObjectConverters.Equal}, ConverterParameter={x:Static models:ContentType.GameInstallation}}"
                                            Command="{Binding SelectContentTypeFilterCommand}"
                                            CommandParameter="{x:Static models:ContentType.GameInstallation}">
                                        <StackPanel Orientation="Horizontal" Spacing="6">
                                            <PathIcon Data="M19,20H4C2.89,20 2,19.1 2,18V6C2,4.89 2.89,4 4,4H10L12,6H19A2,2 0 0,1 21,8H21L4,8V18L6.14,10H23.21L20.93,18.5C20.7,19.37 19.92,20 19,20Z" Width="16" Height="16" />
                                            <TextBlock Text="Installation" FontSize="12" />
                                        </StackPanel>
                                    </Button>
                                    
                                    <Button Classes="filter-pill" Margin="0,0,8,8"
                                            Classes.selected="{Binding SelectedContentType, Converter={x:Static ObjectConverters.Equal}, ConverterParameter={x:Static models:ContentType.GameClient}}"
                                            Command="{Binding SelectContentTypeFilterCommand}"
                                            CommandParameter="{x:Static models:ContentType.GameClient}">
                                        <StackPanel Orientation="Horizontal" Spacing="6">
                                            <PathIcon Data="M20,19V7H4V19H20M20,3A2,2 0 0,1 22,5V19A2,2 0 0,1 20,21H4A2,2 0 0,1 2,19V5C2,3.89 2.9,3 4,3H20" Width="16" Height="16" />
                                            <TextBlock Text="Executable" FontSize="12" />
                                        </StackPanel>
                                    </Button>
                                    
                                    <Button Classes="filter-pill" Margin="0,0,8,8"
                                            Classes.selected="{Binding SelectedContentType, Converter={x:Static ObjectConverters.Equal}, ConverterParameter={x:Static models:ContentType.Mod}}"
                                            Command="{Binding SelectContentTypeFilterCommand}"
                                            CommandParameter="{x:Static models:ContentType.Mod}">
                                        <StackPanel Orientation="Horizontal" Spacing="6">
                                            <PathIcon Data="M22.7,19L13.6,9.9C13.9,9.3 14.1,8.6 14.1,7.9C14.1,5.7 12.4,3.9 10.2,3.9C8,3.9 6.3,5.7 6.3,7.9C6.3,10.1 8,11.8 10.2,11.8C10.9,11.8 11.6,11.6 12.2,11.3L21.3,20.4L22.7,19Z" Width="16" Height="16" />
                                            <TextBlock Text="Mods" FontSize="12" />
                                        </StackPanel>
                                    </Button>
                                    
                                    <Button Classes="filter-pill" Margin="0,0,8,8"
                                            Classes.selected="{Binding SelectedContentType, Converter={x:Static ObjectConverters.Equal}, ConverterParameter={x:Static models:ContentType.MapPack}}"
                                            Command="{Binding SelectContentTypeFilterCommand}"
                                            CommandParameter="{x:Static models:ContentType.MapPack}">
                                        <StackPanel Orientation="Horizontal" Spacing="6">
                                            <PathIcon Data="M15,19L9,16.89V5L15,7.11M20.5,3C20.44,3 20.39,3 20.34,3L15,5.1L9,3L3.36,4.9C3.15,4.97 3,5.15 3,5.38V20.5A0.5,0.5 0 0,0 3.5,21C3.55,21 3.61,21 3.66,20.97L9,18.9L15,21L20.64,19.1C20.85,19 21,18.85 21,18.62V3.5A0.5,0.5 0 0,0 20.5,3Z" Width="16" Height="16" />
                                            <TextBlock Text="Maps" FontSize="12" />
                                        </StackPanel>
                                    </Button>
                                    
                                    <Button Classes="filter-pill" Margin="0,0,8,8"
                                            Classes.selected="{Binding SelectedContentType, Converter={x:Static ObjectConverters.Equal}, ConverterParameter={x:Static models:ContentType.Patch}}"
                                            Command="{Binding SelectContentTypeFilterCommand}"
                                            CommandParameter="{x:Static models:ContentType.Patch}">
                                        <StackPanel Orientation="Horizontal" Spacing="6">
                                            <PathIcon Data="M14.6,16.6L19.2,12L14.6,7.4L16,6L22,12L16,18L14.6,16.6M9.4,16.6L4.8,12L9.4,7.4L8,6L2,12L8,18L9.4,16.6Z" Width="16" Height="16" />
                                            <TextBlock Text="Patches" FontSize="12" />
                                        </StackPanel>
                                    </Button>
                                </WrapPanel>
                                
                                <!-- Available content list -->
                                <Border Background="#0A000000" BorderBrush="#20FFFFFF" BorderThickness="1" 
                                        CornerRadius="6" Padding="8" MinHeight="120" MaxHeight="250">
                                    <ScrollViewer VerticalScrollBarVisibility="Auto">
                                        <ItemsControl ItemsSource="{Binding AvailableContent}">
                                            <ItemsControl.ItemTemplate>
                                                <DataTemplate>
                                                    <Border Background="#10FFFFFF" CornerRadius="4" Padding="10" Margin="0,3">
                                                        <Border.IsVisible>
                                                            <Binding Path="IsEnabled" Converter="{x:Static conv:InvertedBoolToVisibilityConverter.Instance}" />
                                                        </Border.IsVisible>
                                                        <Grid ColumnDefinitions="*,Auto">
                                                            <StackPanel Grid.Column="0" Spacing="3">
                                                                <TextBlock Text="{Binding DisplayName}" FontWeight="SemiBold" FontSize="12" />
                                                                <StackPanel Orientation="Horizontal" Spacing="5">
                                                                    <Border Background="#FF6B6B" CornerRadius="2" Padding="4,1"
                                                                            IsVisible="{Binding Publisher, Converter={x:Static StringConverters.IsNotNullOrEmpty}}">
                                                                        <TextBlock Text="{Binding Publisher}" FontSize="9" Foreground="White" FontWeight="SemiBold" />
                                                                    </Border>
                                                                    <Border Background="{Binding GameType, Converter={x:Static conv:GameTypeToBrushConverter.Instance}}" CornerRadius="2" Padding="4,1">
                                                                        <TextBlock Text="{Binding GameType, Converter={x:Static conv:GameTypeShortDisplayConverter.Instance}}" FontSize="9" Foreground="White" />
                                                                    </Border>
                                                                </StackPanel>
                                                            </StackPanel>
                                                            <Button Grid.Column="1" Content="+ Add" Classes="btn-add"
                                                                    Command="{Binding $parent[ItemsControl].((vm:GameProfileSettingsViewModel)DataContext).EnableContentCommand}"
                                                                    CommandParameter="{Binding}"
                                                                    VerticalAlignment="Center" />
                                                        </Grid>
                                                    </Border>
                                                </DataTemplate>
                                            </ItemsControl.ItemTemplate>
                                        </ItemsControl>
                                    </ScrollViewer>
                                </Border>
                            </StackPanel>
                        </Border>
                        
                    </StackPanel>
                </ScrollViewer>
            </TabItem>

            <!-- Settings Tab -->
            <TabItem Header="ğŸ® Settings">
                <views:GameSettingsView DataContext="{Binding GameSettingsViewModel}" />
            </TabItem>
        </TabControl>

        <!-- Loading overlay -->
        <Border Grid.RowSpan="2" 
                IsVisible="{Binding IsInitializing}"
                Background="#DD000000" 
                ZIndex="1001">
            <StackPanel VerticalAlignment="Center" HorizontalAlignment="Center" Spacing="12">
                <ProgressBar IsIndeterminate="True" Width="180" Height="4"/>
                <TextBlock Text="Loading..." Foreground="White" FontSize="14" HorizontalAlignment="Center"/>
            </StackPanel>
        </Border>

        <!-- Saving overlay -->
        <Border Grid.RowSpan="2"
                IsVisible="{Binding IsSaving}"
                Background="#CC000000"
                ZIndex="1000">
            <StackPanel VerticalAlignment="Center" HorizontalAlignment="Center" Spacing="12">
                <ProgressBar IsIndeterminate="True" Width="180" Height="4"/>
                <TextBlock Text="Saving..." Foreground="White" FontSize="14" HorizontalAlignment="Center"/>
            </StackPanel>
        </Border>

        <!-- Error Panel -->
        <Border Grid.RowSpan="2"
                Background="#CC000000"
                IsVisible="{Binding LoadingError}"
                ZIndex="1000">
            <StackPanel HorizontalAlignment="Center" VerticalAlignment="Center" Spacing="12">
                <TextBlock Text="âŒ Failed to load settings" FontSize="16" Foreground="White" />
                <Button Content="Close" HorizontalAlignment="Center" Command="{Binding ExecuteCancelCommand}" />
            </StackPanel>
        </Border>
    </Grid>
</Window>
