<Window xmlns="https://github.com/avaloniaui"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:vm="clr-namespace:GenHub.Features.GameProfiles.ViewModels"
        xmlns:views="clr-namespace:GenHub.Features.GameProfiles.Views"
        xmlns:models="clr-namespace:GenHub.Core.Models.Enums;assembly=GenHub.Core"
        xmlns:conv="clr-namespace:GenHub.Infrastructure.Converters"
        xmlns:notifications="clr-namespace:GenHub.Features.Notifications.Views"
        mc:Ignorable="d" d:DesignWidth="750" d:DesignHeight="700"
        x:Class="GenHub.Features.GameProfiles.Views.GameProfileSettingsWindow"
        x:DataType="vm:GameProfileSettingsViewModel"
        x:Name="SettingsWindow"
        Title="Profile Settings"
        Width="850" Height="750"
        MinWidth="600" MinHeight="550"
        CanResize="True"
        WindowStartupLocation="CenterOwner"
        Background="#0F0F0F"
        Icon="avares://GenHub/Assets/Icons/generalshub-icon.png"
        ExtendClientAreaToDecorationsHint="True"
        ExtendClientAreaChromeHints="NoChrome"
        ExtendClientAreaTitleBarHeightHint="-1">

    <Window.Resources>
        <conv:ContrastTextColorConverter x:Key="ContrastTextColorConverter" />
        <conv:ColorToBrushConverter x:Key="ColorToBrushConverter" />
        <conv:ThemeBackgroundConverter x:Key="ThemeBackgroundConverter" />
        <conv:ThemeBorderConverter x:Key="ThemeBorderConverter" />
        <conv:BoolToColorConverter x:Key="BoolToColorConverter" />
        <conv:BoolToStatusColorConverter x:Key="BoolToStatusColorConverter" />
        <conv:StringToImageConverter x:Key="StringToImageConverter" />
        <conv:NotNullConverter x:Key="NotNullConverter" />
        <conv:NotNullOrEmptyConverter x:Key="NotNullOrEmptyConverter" />
        <conv:NullSafePropertyConverter x:Key="NullSafeConverter" />
        <conv:NullToVisibilityConverter x:Key="NullToVisibilityConverter" />
        <conv:BoolToVisibilityConverter x:Key="BoolToVisibilityConverter" />
        <conv:InvertedBoolToVisibilityConverter x:Key="InvertedBoolToVisibilityConverter" />
        <conv:TabIndexToVisibilityConverter x:Key="TabIndexToVisibilityConverter" />
        <conv:StringToColorConverter x:Key="StringToColorConverter" />
    </Window.Resources>

    <Window.Styles>


        <!-- Form field -->
        <Style Selector="StackPanel.form-field">
            <Setter Property="Margin" Value="0,0,0,12" />
        </Style>

        <!-- Form label -->
        <Style Selector="TextBlock.form-label">
            <Setter Property="Margin" Value="0,0,0,6" />
            <Setter Property="Opacity" Value="0.85" />
            <Setter Property="FontSize" Value="13" />
            <Setter Property="FontWeight" Value="Medium" />
        </Style>

        <!-- Input fields -->
        <Style Selector="TextBox, ComboBox">
            <Setter Property="MinHeight" Value="36" />
            <Setter Property="Background" Value="#15FFFFFF" />
            <Setter Property="BorderBrush" Value="#30FFFFFF" />
            <Setter Property="CornerRadius" Value="6" />
            <Setter Property="Foreground" Value="White" />
        </Style>

        <Style Selector="TextBox">
            <Setter Property="CaretBrush" Value="White" />
        </Style>

        <!-- Compact color button -->
        <Style Selector="Button.color-btn">
            <Setter Property="Width" Value="28" />
            <Setter Property="Height" Value="28" />
            <Setter Property="Margin" Value="0,0,6,6" />
            <Setter Property="Padding" Value="0" />
            <Setter Property="CornerRadius" Value="14" />
            <Setter Property="Cursor" Value="Hand" />
        </Style>

        <!-- Content action buttons -->
        <Style Selector="Button.btn-add">
            <Setter Property="Background" Value="#15FFFFFF" />
            <Setter Property="BorderBrush" Value="#40FFFFFF" />
            <Setter Property="BorderThickness" Value="1" />
            <Setter Property="Foreground" Value="#9575CD" />
            <Setter Property="CornerRadius" Value="6" />
            <Setter Property="Padding" Value="14,6" />
            <Setter Property="FontSize" Value="12" />
            <Setter Property="FontWeight" Value="SemiBold" />
            <Setter Property="Cursor" Value="Hand" />
        </Style>
        <Style Selector="Button.btn-add:pointerover /template/ ContentPresenter">
            <Setter Property="Background" Value="#9575CD" />
            <Setter Property="BorderBrush" Value="#9575CD" />
            <Setter Property="Foreground" Value="White" />
        </Style>

        <Style Selector="Button.btn-remove">
            <Setter Property="Background" Value="#15FFFFFF" />
            <Setter Property="BorderBrush" Value="#FF5252" />
            <Setter Property="BorderThickness" Value="1" />
            <Setter Property="Foreground" Value="#FF5252" />
            <Setter Property="CornerRadius" Value="6" />
            <Setter Property="Padding" Value="8,5" />
            <Setter Property="FontSize" Value="12" />
            <Setter Property="FontWeight" Value="SemiBold" />
            <Setter Property="Cursor" Value="Hand" />
        </Style>
        <Style Selector="Button.btn-remove:pointerover /template/ ContentPresenter">
            <Setter Property="Background" Value="#FF5252" />
            <Setter Property="BorderBrush" Value="#FF5252" />
            <Setter Property="Foreground" Value="White" />
        </Style>

        <!-- Content filter pills -->
        <Style Selector="Button.filter-pill">
            <Setter Property="Background">
                <LinearGradientBrush StartPoint="0%,0%" EndPoint="100%,100%">
                    <GradientStop Offset="0" Color="#50FFFFFF"/>
                    <GradientStop Offset="0.5" Color="#20FFFFFF"/>
                    <GradientStop Offset="1" Color="#05FFFFFF"/>
                </LinearGradientBrush>
            </Setter>
            <Setter Property="Margin" Value="4" />
            <Setter Property="Foreground" Value="White" />
            <Setter Property="BorderBrush">
                <LinearGradientBrush StartPoint="0%,0%" EndPoint="100%,100%">
                    <GradientStop Offset="0" Color="#D0FFFFFF"/>
                    <GradientStop Offset="1" Color="#40FFFFFF"/>
                </LinearGradientBrush>
            </Setter>
            <Setter Property="BorderThickness" Value="1.5" />
            <Setter Property="CornerRadius" Value="10" />
            <Setter Property="Padding" Value="16,10" />
            <Setter Property="MinWidth" Value="110" />
            <Setter Property="Cursor" Value="Hand" />
            <Setter Property="HorizontalContentAlignment" Value="Center" />
            <Setter Property="FontWeight" Value="SemiBold" />
        </Style>

        <Style Selector="Button.filter-pill TextBlock">
             <Setter Property="Effect">
                 <DropShadowEffect BlurRadius="4" Color="#000000" Opacity="0.8" OffsetX="1" OffsetY="1" />
            </Setter>
        </Style>

        <!-- Hover: Brighten the 'glass' significantly. RenderTransform moved to Button to avoid clipping -->
        <Style Selector="Button.filter-pill:pointerover /template/ ContentPresenter">
            <Setter Property="Background" Value="#50000000" />
            <Setter Property="BorderBrush" Value="#FFFFFFFF" />
        </Style>

        <Style Selector="Button.filter-pill:pointerover">
            <Setter Property="RenderTransform" Value="translateY(-2px)" />
            <Setter Property="ZIndex" Value="10" />
        </Style>

        <Style Selector="Button.filter-pill:pressed">
             <Setter Property="RenderTransform" Value="scale(0.96)" />
        </Style>

        <Style Selector="Button.filter-pill.selected /template/ ContentPresenter" x:CompileBindings="False">
            <Setter Property="Background" Value="{Binding $parent[Button].DataContext.ColorValue, Converter={StaticResource ColorToBrushConverter}}" />
            <Setter Property="BorderBrush">
                 <LinearGradientBrush StartPoint="0%,0%" EndPoint="100%,100%">
                    <GradientStop Offset="0" Color="#FFFFFFFF"/>
                    <GradientStop Offset="1" Color="#AAFFFFFF"/>
                </LinearGradientBrush>
            </Setter>
            <Setter Property="Opacity" Value="1" />
        </Style>

        <Style Selector="Button.filter-pill.selected">
            <Setter Property="ZIndex" Value="1" />
            <Setter Property="BorderThickness" Value="2" />
        </Style>

        <!-- Selected text gets a strong shadow to pop against the colored background -->
        <Style Selector="Button.filter-pill.selected TextBlock">
            <Setter Property="Foreground" Value="White" />
            <Setter Property="FontWeight" Value="Bold" />
             <Setter Property="Effect">
                 <DropShadowEffect BlurRadius="4" Color="Black" Opacity="0.5" OffsetX="0" OffsetY="2" />
            </Setter>
        </Style>

        <Style Selector="Button.filter-pill.selected PathIcon">
            <Setter Property="Foreground" Value="White" />
             <Setter Property="Effect">
                 <DropShadowEffect BlurRadius="4" Color="Black" Opacity="0.5" OffsetX="0" OffsetY="2" />
            </Setter>
        </Style>

        <!-- Conjoined pills -->
        <Style Selector="Button.filter-pill.left">
            <Setter Property="CornerRadius" Value="10,0,0,10" />
            <Setter Property="MinWidth" Value="100" />
            <Setter Property="Margin" Value="4,4,-1,4" />
        </Style>
        <Style Selector="Button.filter-pill.right">
            <Setter Property="CornerRadius" Value="0,10,10,0" />
            <Setter Property="MinWidth" Value="100" />
        </Style>

        <!-- Tab icon button style -->
        <Style Selector="Button.tab-icon-btn">
            <Setter Property="Width" Value="64" />
            <Setter Property="Height" Value="64" />
            <Setter Property="Background" Value="#15FFFFFF" />
            <Setter Property="BorderBrush" Value="#60FFFFFF" />
            <Setter Property="BorderThickness" Value="2" />
            <Setter Property="CornerRadius" Value="12" />
            <Setter Property="Padding" Value="12" />
            <Setter Property="Cursor" Value="Hand" />
            <Setter Property="Opacity" Value="1" />
            <Setter Property="Foreground" Value="White" />
        </Style>
        <Style Selector="Button.tab-icon-btn PathIcon">
             <Setter Property="Foreground" Value="White" />
        </Style>
        <Style Selector="Button.tab-icon-btn Panel > Border">
             <Setter Property="Background" Value="White" />
        </Style>
        <Style Selector="Button.tab-icon-btn:pointerover /template/ ContentPresenter" x:CompileBindings="False">
            <Setter Property="Background" Value="{Binding ColorValue, Converter={StaticResource ColorToBrushConverter}}" />
            <Setter Property="Opacity" Value="0.2" />
        </Style>
        <Style Selector="Button.tab-icon-btn:pointerover">
            <Setter Property="Background" Value="#50000000" />
            <Setter Property="BorderBrush" Value="White" />
            <Setter Property="BorderThickness" Value="2" />
            <Setter Property="RenderTransform" Value="translateY(-4px)" />
        </Style>
        <Style Selector="Button.tab-icon-btn.selected /template/ ContentPresenter" x:CompileBindings="False">
            <Setter Property="Background" Value="{Binding ColorValue, Converter={StaticResource ColorToBrushConverter}}" />
        </Style>
        <Style Selector="Button.tab-icon-btn.selected">
            <Setter Property="BorderBrush" Value="White" />
            <Setter Property="BorderThickness" Value="3" />
            <Setter Property="RenderTransform" Value="scale(1.1)" />
            <Setter Property="ZIndex" Value="5" />
            <Setter Property="Effect">
                <DropShadowEffect BlurRadius="12" Color="Black" Opacity="0.5" OffsetX="0" OffsetY="4" />
            </Setter>
        </Style>
        <Style Selector="Button.tab-icon-btn.selected PathIcon">
             <Setter Property="Foreground" Value="White" />
        </Style>
        <Style Selector="Button.tab-icon-btn.selected Panel > Border">
             <Setter Property="Background" Value="White" />
        </Style>

        <!-- Scrollbar theming -->
        <Style Selector="ScrollBar">
            <Setter Property="Background" Value="#0F0F0F" />
        </Style>
        <Style Selector="ScrollBar /template/ Thumb">
            <Setter Property="Background" Value="#5E35B1" />
            <Setter Property="Opacity" Value="0.7" />
        </Style>
        <Style Selector="ScrollBar /template/ Thumb:pointerover">
            <Setter Property="Opacity" Value="0.9" />
        </Style>
        <Style Selector="ScrollBar /template/ Thumb:pressed">
            <Setter Property="Opacity" Value="1" />
        </Style>
        <Style Selector="ScrollBar.vertical /template/ Thumb">
            <Setter Property="MinWidth" Value="6" />
            <Setter Property="CornerRadius" Value="3" />
        </Style>
        <Style Selector="ScrollBar.horizontal /template/ Thumb">
            <Setter Property="MinHeight" Value="6" />
            <Setter Property="CornerRadius" Value="3" />
        </Style>

        <!-- New Content Card Styles -->
        <Style Selector="Button.content-card-btn">
            <Setter Property="Background" Value="#08FFFFFF" />
            <Setter Property="BorderBrush" Value="#15FFFFFF" />
            <Setter Property="BorderThickness" Value="1" />
            <Setter Property="CornerRadius" Value="8" />
            <Setter Property="Padding" Value="12" />
            <Setter Property="Margin" Value="4" />
            <Setter Property="MinWidth" Value="250" />
            <Setter Property="MaxWidth" Value="400" />
            <Setter Property="HorizontalContentAlignment" Value="Stretch" />
            <Setter Property="VerticalContentAlignment" Value="Stretch" />
            <Setter Property="Cursor" Value="Hand" />
            <Setter Property="Transitions">
                <Transitions>
                    <BrushTransition Property="Background" Duration="0:0:0.1" />
                    <BrushTransition Property="BorderBrush" Duration="0:0:0.1" />
                </Transitions>
            </Setter>
        </Style>
        <Style Selector="Button.content-card-btn:pointerover">
            <Setter Property="Background" Value="#12FFFFFF" />
            <Setter Property="BorderBrush" Value="#40FFFFFF" />
        </Style>
        <Style Selector="Button.content-card-btn:pointerover /template/ ContentPresenter">
            <Setter Property="Background" Value="#12FFFFFF" />
            <Setter Property="BorderBrush" Value="#40FFFFFF" />
        </Style>

        <!-- Style to show children on hover -->
        <Style Selector="Button.delete-reveal-btn">
            <Setter Property="Opacity" Value="0" />
            <Setter Property="Transitions">
                <Transitions>
                    <DoubleTransition Property="Opacity" Duration="0:0:0.15" />
                </Transitions>
            </Setter>
        </Style>

        <!-- When parent card is hovered, reveal the delete button -->
        <Style Selector="Button.content-card-btn:pointerover Button.delete-reveal-btn">
            <Setter Property="Opacity" Value="1" />
        </Style>

        <!-- Ensure the delete button itself reacts to its own hover -->
        <Style Selector="Button.delete-reveal-btn:pointerover">
            <Setter Property="Opacity" Value="1" />
            <Setter Property="Background" Value="#D32F2F" />
        </Style>
        <!-- Corner Accent Style -->
        <Style Selector="Path.corner-accent">
            <Setter Property="Stroke" Value="#B19CD9" /> <!-- GenHub Purple accent -->
            <Setter Property="StrokeThickness" Value="1.5" />
            <Setter Property="StrokeJoin" Value="Miter" />
            <Setter Property="Opacity" Value="0.6" />
            <Setter Property="Effect">
                <DropShadowEffect BlurRadius="8" Color="#9575CD" Opacity="0.4" OffsetX="0" OffsetY="0" />
            </Setter>
        </Style>

        <!-- Specific Bottom Right Accent Style -->
        <Style Selector="Path.corner-accent.bottom-right">
             <Setter Property="StrokeThickness" Value="5" />
             <Setter Property="Opacity" Value="1" />
             <Setter Property="Effect">
                <DropShadowEffect BlurRadius="15" Color="#9575CD" Opacity="1.0" OffsetX="0" OffsetY="0" />
            </Setter>
        </Style>

        <!-- Edge Accent Style -->
        <Style Selector="Border.edge-accent">
            <Setter Property="Opacity" Value="0.5" />
            <Setter Property="Effect">
                <DropShadowEffect BlurRadius="10" Color="#9575CD" Opacity="0.3" OffsetX="0" OffsetY="0" />
            </Setter>
        </Style>

        <!-- Footer Row Style -->
        <Style Selector="Border.footer-row">
            <Setter Property="Background" Value="#15000000" />
            <Setter Property="BorderBrush" Value="#20FFFFFF" />
            <Setter Property="BorderThickness" Value="0,1,0,0" />
            <Setter Property="Padding" Value="24,12" />
        </Style>

        <!-- Save FAB Style -->
        <Style Selector="Button.save-fab">
            <Setter Property="Height" Value="50" />
            <Setter Property="MinWidth" Value="130" />
            <Setter Property="CornerRadius" Value="25" />
            <Setter Property="Padding" Value="24,0" />
            <Setter Property="Margin" Value="0" />
            <Setter Property="HorizontalAlignment" Value="Center" />
            <Setter Property="VerticalAlignment" Value="Center" />
            <Setter Property="ClipToBounds" Value="False" />
            <Setter Property="ToolTip.Tip" Value="Save Profile Changes" />
            <Setter Property="Transitions">
                <Transitions>
                    <TransformOperationsTransition Property="RenderTransform" Duration="0:0:0.2" Easing="CubicEaseOut" />
                    <BrushTransition Property="Background" Duration="0:0:0.2" />
                </Transitions>
            </Setter>
        </Style>

        <Style Selector="Button.save-fab:pointerover">
            <Setter Property="RenderTransform" Value="scale(1.05)" />
            <Setter Property="Effect">
                <DropShadowEffect BlurRadius="15" Color="{Binding ColorValue, Converter={StaticResource StringToColorConverter}}" Opacity="0.5" OffsetX="0" OffsetY="0" />
            </Setter>
        </Style>

        <Style Selector="Button.save-fab:pressed">
            <Setter Property="RenderTransform" Value="scale(0.96)" />
        </Style>

        <Style Selector="Button.save-fab > StackPanel > PathIcon">
            <Setter Property="Width" Value="20" />
            <Setter Property="Height" Value="20" />
            <Setter Property="Foreground" Value="White" />
        </Style>

        <Style Selector="Button.save-fab TextBlock">
            <Setter Property="FontSize" Value="15" />
            <Setter Property="FontWeight" Value="Heavy" />
            <Setter Property="LetterSpacing" Value="1.5" />
            <Setter Property="Foreground" Value="White" />
        </Style>

    </Window.Styles>

    <Border Background="{Binding ColorValue, Converter={StaticResource ThemeBackgroundConverter}, Mode=OneWay}"
            BorderBrush="{Binding ColorValue, Converter={StaticResource ThemeBorderConverter}, Mode=OneWay}"
            BorderThickness="1">
        <Panel>
            <!-- Background Artwork Overlay -->
            <Image Source="{Binding CoverPath, Mode=OneWay, Converter={StaticResource StringToImageConverter}}"
                   Stretch="UniformToFill"
                   Opacity="0.1"
                   HorizontalAlignment="Stretch"
                   VerticalAlignment="Stretch" />

            <!-- Edge Accents -->
            <Border Classes="edge-accent" HorizontalAlignment="Right" Width="1.5" BoxShadow="0 0 10 0 #40B19CD9" Background="{Binding ColorValue, Converter={StaticResource ColorToBrushConverter}}" />
            <Border Classes="edge-accent" VerticalAlignment="Bottom" Height="1.5" BoxShadow="0 0 10 0 #40B19CD9" Background="{Binding ColorValue, Converter={StaticResource ColorToBrushConverter}}" />

            <!-- Corner Accents at absolute edges -->
            <Canvas HorizontalAlignment="Stretch" VerticalAlignment="Stretch" IsHitTestVisible="False">
                <!-- Top Left -->
                <Path Classes="corner-accent" Data="M 0,15 L 0,0 L 15,0" Canvas.Top="0" Canvas.Left="0" />
                <!-- Top Right -->
                <Path Classes="corner-accent" Data="M 0,0 L 15,0 L 15,15" Canvas.Top="0" Canvas.Right="0" />
                <!-- Bottom Left -->
                <Path Classes="corner-accent" Data="M 15,15 L 0,15 L 0,0" Canvas.Bottom="0" Canvas.Left="0" />
                <!-- Bottom Right (Enhanced) -->
                <Path Classes="corner-accent bottom-right" Data="M 0,35 L 35,35 L 35,0" Canvas.Bottom="0" Canvas.Right="0" />
            </Canvas>

            <Grid RowDefinitions="Auto,Auto,*">
                <!-- Redesigned Minimal Header -->
                <Border Grid.Row="0"
                        Background="Transparent"
                        Height="60"
                        PointerPressed="OnHeaderPointerPressed"
                        PointerMoved="OnHeaderPointerMoved"
                        PointerReleased="OnHeaderPointerReleased">
                    <Grid ColumnDefinitions="Auto,*,Auto" Margin="24,0">
                        <!-- Profile Icon & Name Group -->
                        <StackPanel Grid.Column="0" Orientation="Horizontal" Spacing="16" VerticalAlignment="Center">
                            <Border Width="36" Height="36"
                                    Background="#25FFFFFF"
                                    CornerRadius="18"
                                    ClipToBounds="True"
                                    BorderBrush="White"
                                    BorderThickness="1.5">
                                <Image Source="{Binding IconPath, Mode=OneWay, Converter={StaticResource StringToImageConverter}}"
                                       Width="36" Height="36"
                                       Stretch="UniformToFill" />
                            </Border>
                            <StackPanel VerticalAlignment="Center">
                                <TextBlock Text="{Binding Name, Mode=OneWay, FallbackValue='New Profile'}"
                                           Foreground="White"
                                           FontSize="18"
                                           FontWeight="Bold" />
                                <TextBlock Text="Profile Settings"
                                           Foreground="#B19CD9"
                                           FontSize="10"
                                           FontWeight="SemiBold"
                                           LetterSpacing="1"
                                           Opacity="0.8" />
                            </StackPanel>
                        </StackPanel>

                        <StackPanel Grid.Column="2" Orientation="Horizontal" Spacing="8" VerticalAlignment="Center">
                            <!-- Randomize Color -->
                            <Button Command="{Binding RandomizeColorCommand}"
                                    Classes="tab-icon-btn"
                                    Width="32" Height="32" Padding="6" CornerRadius="16"
                                    ToolTip.Tip="Randomize profile color">
                                <PathIcon Data="M17.65,6.35C16.2,4.9 14.21,4 12,4A8,8 0 0,0 4,12A8,8 0 0,0 12,20C15.73,20 18.84,17.45 19.73,14H17.65C16.83,16.33 14.61,18 12,18A6,6 0 0,1 6,12A6,6 0 0,1 12,6C13.66,6 15.14,6.69 16.22,7.78L13,11H20V4L17.65,6.35Z"
                                          Width="14" Height="14" />
                            </Button>

                            <!-- Toggle Fullscreen -->
                            <Button Click="OnToggleFullscreenClick"
                                    Classes="tab-icon-btn"
                                    Width="32" Height="32" Padding="6" CornerRadius="16"
                                    ToolTip.Tip="Toggle Fullscreen">
                                <PathIcon Data="M4,4H20V20H4V4M6,8V18H18V8H6Z"
                                          Width="14" Height="14" />
                            </Button>

                            <!-- Close Button -->
                            <Button Command="{Binding ExecuteCancelCommand}"
                                    Classes="tab-icon-btn"
                                    Width="32" Height="32" Padding="6" CornerRadius="16"
                                    Background="#20FF5252"
                                    ToolTip.Tip="Close (Esc)">
                                <PathIcon Data="M19,6.41L17.59,5L12,10.59L6.41,5L5,6.41L10.59,12L5,17.59L6.41,19L12,13.41L17.59,19L19,17.59L13.41,12L19,6.41Z"
                                          Width="14" Height="14" />
                                <Button.Styles>
                                    <Style Selector="Button:pointerover /template/ ContentPresenter">
                                        <Setter Property="Background" Value="#CCFF5252" />
                                    </Style>
                                </Button.Styles>
                            </Button>
                        </StackPanel>
                    </Grid>
                </Border>

                <!-- Global Navigation at the Top -->
                <views:GameProfileNavigationView Grid.Row="1" Margin="24,0,24,12" />

                <!-- Tab Content Panels -->
                <Grid Grid.Row="2" Margin="12,0,12,12" ClipToBounds="True">
                    <!-- Content Tab Panel (Index 0) -->
                    <views:GameProfileContentSettingsView IsVisible="{Binding SelectedTabIndex, Converter={StaticResource TabIndexToVisibilityConverter}, ConverterParameter=0}" />

                    <!-- Profile Settings Panel (Index 1) -->
                    <views:GameProfileGeneralSettingsView IsVisible="{Binding SelectedTabIndex, Converter={StaticResource TabIndexToVisibilityConverter}, ConverterParameter=1}" />

                    <!-- Game Settings Panel (Index 2) -->
                    <Panel IsVisible="{Binding SelectedTabIndex, Converter={StaticResource TabIndexToVisibilityConverter}, ConverterParameter=2}">
                        <views:GameSettingsView DataContext="{Binding GameSettingsViewModel}" />
                    </Panel>
                </Grid>

        <!-- Add Local Content Dialog -->
        <Border Grid.RowSpan="2"
                IsVisible="{Binding IsAddLocalContentDialogOpen}"
                Background="#CC000000"
                ZIndex="1002">
            <Border Background="{Binding ColorValue, Converter={StaticResource ThemeBackgroundConverter}, Mode=OneWay}"
                    BorderBrush="{Binding ColorValue, Converter={StaticResource ThemeBorderConverter}, Mode=OneWay}"
                    BorderThickness="2"
                    CornerRadius="16"
                    Width="420"
                    Padding="24"
                    VerticalAlignment="Center"
                    HorizontalAlignment="Center"
                    TextElement.Foreground="White">
                <StackPanel Spacing="16">
                    <!-- Header -->
                    <StackPanel Orientation="Horizontal" Spacing="12">
                        <TextBlock Text="ðŸ“" FontSize="24" VerticalAlignment="Center" />
                        <TextBlock Text="Add Local Content" FontSize="18" FontWeight="SemiBold" VerticalAlignment="Center" />
                    </StackPanel>

                    <!-- Selected Folder -->
                    <StackPanel Spacing="6">
                        <TextBlock Text="Selected Folder" FontSize="12" Opacity="0.8" />
                        <Border Background="#15FFFFFF" CornerRadius="6" Padding="10,8">
                            <TextBlock Text="{Binding LocalContentDirectoryPath}"
                                       FontSize="11"
                                       TextTrimming="CharacterEllipsis"
                                       ToolTip.Tip="{Binding LocalContentDirectoryPath}" />
                        </Border>
                    </StackPanel>

                    <!-- Content Name -->
                    <StackPanel Spacing="6">
                        <TextBlock Text="Content Name" FontSize="12" Opacity="0.8" />
                        <TextBox Text="{Binding LocalContentName, Mode=TwoWay}"
                                 Watermark="Enter a name for this content"
                                 MinHeight="36" />
                    </StackPanel>

                    <!-- Content Type -->
                    <StackPanel Spacing="6">
                        <TextBlock Text="Content Type" FontSize="12" Opacity="0.8" />
                        <ComboBox ItemsSource="{x:Static vm:GameProfileSettingsViewModel.AllowedLocalContentTypes}"
                                  SelectedItem="{Binding SelectedLocalContentType}"
                                  HorizontalAlignment="Stretch"
                                  MinHeight="36">
                            <ComboBox.ItemTemplate>
                                <DataTemplate>
                                    <TextBlock Text="{Binding Converter={x:Static conv:ContentTypeDisplayConverter.Instance}}" />
                                </DataTemplate>
                            </ComboBox.ItemTemplate>
                        </ComboBox>
                        <TextBlock Text="Publisher will be set to 'GenHub (Local)' for local content"
                                   FontSize="10" Opacity="0.6" FontStyle="Italic" />
                    </StackPanel>

                    <!-- Game Type Selection - Always visible -->
                    <StackPanel Spacing="6">
                        <TextBlock Text="Target Game" FontSize="12" Opacity="0.8" />
                        <ComboBox ItemsSource="{x:Static vm:GameProfileSettingsViewModel.AvailableLocalGameTypes}"
                                  SelectedItem="{Binding SelectedLocalGameType}"
                                  HorizontalAlignment="Stretch"
                                  MinHeight="36">
                            <ComboBox.ItemTemplate>
                                <DataTemplate>
                                    <TextBlock Text="{Binding Converter={x:Static conv:GameTypeDisplayConverter.Instance}}" />
                                </DataTemplate>
                            </ComboBox.ItemTemplate>
                        </ComboBox>
                        <TextBlock Text="Specify which game version this executable belongs to"
                                   FontSize="10" Opacity="0.6" FontStyle="Italic" />
                    </StackPanel>

                    <!-- Action Buttons -->
                    <Grid ColumnDefinitions="*,Auto,Auto" Margin="0,8,0,0">
                        <Button Grid.Column="1" Content="Cancel"
                                Command="{Binding CancelAddLocalContentCommand}"
                                Background="#25000000"
                                Foreground="White"
                                BorderBrush="#40FFFFFF"
                                BorderThickness="1"
                                Width="90" Height="36"
                                CornerRadius="8"
                                FontWeight="Medium"
                                Margin="0,0,12,0" />
                        <Button Grid.Column="2" Content="âœ“ Add Content"
                                Command="{Binding ConfirmAddLocalContentCommand}"
                                Background="{Binding ColorValue, Converter={StaticResource ColorToBrushConverter}, Mode=OneWay}"
                                Foreground="White"
                                Width="120" Height="36"
                                CornerRadius="8"
                                FontWeight="Bold" />
                    </Grid>
                </StackPanel>
            </Border>
        </Border>
        <!-- Loading overlay -->
        <Border Grid.RowSpan="2"
                IsVisible="{Binding IsInitializing}"
                Background="#DD000000"
                ZIndex="1001">
            <StackPanel VerticalAlignment="Center" HorizontalAlignment="Center" Spacing="12">
                <ProgressBar IsIndeterminate="True" Width="180" Height="4"/>
                <TextBlock Text="Loading..." Foreground="White" FontSize="14" HorizontalAlignment="Center"/>
            </StackPanel>
        </Border>

        <!-- Saving overlay -->
        <Border Grid.RowSpan="2"
                IsVisible="{Binding IsSaving}"
                Background="#CC000000"
                ZIndex="1000">
            <StackPanel VerticalAlignment="Center" HorizontalAlignment="Center" Spacing="12">
                <ProgressBar IsIndeterminate="True" Width="180" Height="4"/>
                <TextBlock Text="Saving..." Foreground="White" FontSize="14" HorizontalAlignment="Center"/>
            </StackPanel>
        </Border>

        <!-- Error Panel -->
        <Border Grid.RowSpan="2"
                Background="#CC000000"
                IsVisible="{Binding LoadingError}"
                ZIndex="1000">
            <StackPanel HorizontalAlignment="Center" VerticalAlignment="Center" Spacing="12">
                <TextBlock Text="âŒ Failed to load settings" FontSize="16" Foreground="White" />
                <Button Content="Close" HorizontalAlignment="Center" Command="{Binding ExecuteCancelCommand}" />
            </StackPanel>
        </Border>

        <notifications:NotificationContainerView Grid.RowSpan="2"
                                               DataContext="{Binding NotificationManager}"
                                               ZIndex="2000" />


            </Grid>

            <!-- Floating Action Button for Global Save -->
            <Border ZIndex="500"
                    HorizontalAlignment="Right"
                    VerticalAlignment="Bottom"
                    Margin="0,0,40,40"
                    BoxShadow="0 15 35 0 #80000000"
                    CornerRadius="25"
                    IsVisible="{Binding !IsSaving}"
                    IsHitTestVisible="True">
                <Button Classes="save-fab"
                        Command="{Binding SaveCommand}"
                        Background="Transparent"
                        Margin="0">
                    <Button.Background>
                        <LinearGradientBrush StartPoint="0%,0%" EndPoint="100%,100%">
                            <GradientStop Offset="0" Color="{Binding ColorValue, Converter={StaticResource StringToColorConverter}}" />
                            <GradientStop Offset="1" Color="#40000000" />
                        </LinearGradientBrush>
                    </Button.Background>
                    <StackPanel Orientation="Horizontal" Spacing="12">
                        <PathIcon Data="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z" />
                        <TextBlock Text="SAVE" VerticalAlignment="Center" />
                    </StackPanel>
                </Button>
            </Border>
        </Panel>
</Border>
</Window>
