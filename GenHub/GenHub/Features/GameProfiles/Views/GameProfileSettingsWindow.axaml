<Window xmlns="https://github.com/avaloniaui"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:vm="clr-namespace:GenHub.Features.GameProfiles.ViewModels"
        xmlns:models="clr-namespace:GenHub.Core.Models;assembly=GenHub.Core"
        xmlns:conv="clr-namespace:GenHub.Infrastructure.Converters"
        xmlns:helpers="clr-namespace:GenHub.Helpers"
        mc:Ignorable="d" d:DesignWidth="550" d:DesignHeight="600"
        x:Class="GenHub.Features.GameProfiles.Views.GameProfileSettingsWindow"
        x:DataType="vm:GameProfileSettingsViewModel"
        Title="Profile Settings"
        Width="550" Height="750"
        MinWidth="550" MinHeight="700"
        CanResize="True"
        WindowStartupLocation="CenterOwner"
        Background="#141414"
        Icon="avares://GenHub/Assets/Icons/genhub-logo.png">    <Window.Resources>
        <!-- Keep existing converters -->
        <conv:ContrastTextColorConverter x:Key="ProfileSettings_ContrastTextColorConverter" />
        <conv:BoolToColorConverter x:Key="BoolToColorConverter" />
        <conv:BoolToStatusColorConverter x:Key="BoolToStatusColorConverter" />
        <conv:StringToImageConverter x:Key="StringToImageConverter" />
        <conv:NotNullConverter x:Key="NotNullConverter" />
        <conv:NotNullOrEmptyConverter x:Key="NotNullOrEmptyConverter" />
        <conv:NullSafePropertyConverter x:Key="NullSafeConverter" />
        <conv:NullToVisibilityConverter x:Key="NullToVisibilityConverter" />
        <conv:BoolToVisibilityConverter x:Key="BoolToVisibilityConverter" />
        <conv:InvertedBoolToVisibilityConverter x:Key="InvertedBoolToVisibilityConverter" />
        </Window.Resources>

    <Window.Styles>
        <!-- Tab item styles -->
        <Style Selector="TabItem">
            <Setter Property="FontSize" Value="14" />
            <Setter Property="Height" Value="40" />
            <Setter Property="Margin" Value="0,0,10,0" />
            <Setter Property="Padding" Value="15,8" />
            <Setter Property="VerticalContentAlignment" Value="Center" />
        </Style>

        <!-- Form field style -->
        <Style Selector="StackPanel.form-field">
            <Setter Property="Margin" Value="0,0,0,15" />
            <Setter Property="MaxWidth" Value="500" />
        </Style>

        <!-- Form label style -->
        <Style Selector="TextBlock.form-label">
            <Setter Property="Margin" Value="0,0,0,4" />
            <Setter Property="Opacity" Value="0.8" />
            <Setter Property="FontSize" Value="13" />
        </Style>

        <!-- Color picker button style -->
        <Style Selector="Button.color-button">
            <Setter Property="Width" Value="32" />
            <Setter Property="Height" Value="32" />
            <Setter Property="Margin" Value="0,0,8,8" />
            <Setter Property="Padding" Value="0" />
            <Setter Property="CornerRadius" Value="16" />
        </Style>
        
        <!-- Input field style -->
        <Style Selector="TextBox">
            <Setter Property="MaxWidth" Value="500" />
        </Style>
        
        <!-- Dropdown style -->
        <Style Selector="ComboBox">
            <Setter Property="MaxWidth" Value="500" />
        </Style>
        
        <!-- Info card style -->
        <Style Selector="Border.info-card">
            <Setter Property="Background" Value="#22FFFFFF" />
            <Setter Property="CornerRadius" Value="5" />
            <Setter Property="Padding" Value="15" />
            <Setter Property="Margin" Value="0,0,0,15" />
            <Setter Property="MaxWidth" Value="500" />
        </Style>
        
        <!-- Info card item style -->
        <Style Selector="StackPanel.info-item">
            <Setter Property="Orientation" Value="Horizontal" />
            <Setter Property="Margin" Value="0,0,0,5" />
        </Style>
        
        <!-- Info card label style -->
        <Style Selector="TextBlock.info-label">
            <Setter Property="FontWeight" Value="SemiBold" />
            <Setter Property="Margin" Value="0,0,5,0" />
            <Setter Property="MinWidth" Value="100" />
        </Style>
    </Window.Styles>

    <Grid RowDefinitions="Auto,*,Auto">
        <!-- Header with profile preview - Force update bindings -->
        <Border Grid.Row="0" Background="{Binding ColorValue, Mode=OneWay}" 
            CornerRadius="0,0,0,30" Height="100">
            <Grid ColumnDefinitions="Auto,*,Auto" Margin="20">
                <!-- Profile Icon -->
                <Border Grid.Column="0"
                    Width="60" Height="60"
                    Background="#30FFFFFF"
                    CornerRadius="30">
                    <Image
                        Name="PreviewIcon"
                        Source="{Binding IconPath, Converter={StaticResource StringToImageConverter}, Mode=OneWay}"
                        Width="40" Height="40" />
                </Border>

                <!-- Profile Name -->
                <StackPanel Grid.Column="1" VerticalAlignment="Center" Margin="15,0,0,0">
                    <TextBlock Name="PreviewName"
                        Text="{Binding Name, Mode=OneWay}"
                        Foreground="{Binding ColorValue, Converter={StaticResource ProfileSettings_ContrastTextColorConverter}, Mode=OneWay}"
                        FontSize="22"
                        FontWeight="SemiBold" />
                    <TextBlock Name="PreviewDesc"
                        Text="{Binding Description, Mode=OneWay}"
                        Foreground="{Binding ColorValue, Converter={StaticResource ProfileSettings_ContrastTextColorConverter}, ConverterParameter=0.7, Mode=OneWay}"
                        FontSize="14" />
                </StackPanel>

                <!-- Random Color Button -->
                <Button Grid.Column="2"
                    Command="{Binding RandomizeColorCommand}"
                    Background="#30FFFFFF"
                    Width="40" Height="40"
                    CornerRadius="20"
                    Padding="0"
                    ToolTip.Tip="Randomize profile color">
                    <PathIcon
                        Data="M12,18V6A6,6 0 0,1 18,12A6,6 0 0,1 12,18M12,16A4,4 0 0,0 16,12A4,4 0 0,0 12,8V16M12,2A10,10 0 0,1 22,12A10,10 0 0,1 12,22A10,10 0 0,1 2,12A10,10 0 0,1 12,2M12,20A8,8 0 0,0 20,12A8,8 0 0,0 12,4A8,8 0 0,0 4,12A8,8 0 0,0 12,20Z"
                        Width="20" Height="20"
                        Foreground="{Binding ColorValue, Converter={StaticResource ProfileSettings_ContrastTextColorConverter}, FallbackValue=White}" />
                </Button>
            </Grid>
        </Border>

        <!-- Main settings -->
        <TabControl Grid.Row="1" Margin="20,10" Background="Transparent" Name="SettingsTabControl">
            <!-- General Tab -->
            <TabItem Header="General">
                <ScrollViewer>
                    <StackPanel Margin="0,10,0,0">
                        <!-- Name -->
                        <StackPanel Classes="form-field">
                            <TextBlock Classes="form-label" Text="Profile Name" />
                            <TextBox Text="{Binding Name, Mode=TwoWay}" 
                                     Watermark="Enter a name for this profile" />
                        </StackPanel>

                        <!-- Description -->
                        <StackPanel Classes="form-field">
                            <TextBlock Classes="form-label" Text="Description" />
                            <TextBox Text="{Binding Description, Mode=TwoWay}" 
                                     Watermark="Enter a description" Height="60" 
                                     AcceptsReturn="True" TextWrapping="Wrap" />
                        </StackPanel>

                        <!-- Icon -->
                        <StackPanel Classes="form-field">
                            <TextBlock Classes="form-label" Text="Icon" />
                            <Grid ColumnDefinitions="*,Auto">
                                <ComboBox Grid.Column="0" 
                                          Name="IconComboBox"
                                          ItemsSource="{Binding AvailableIcons}" 
                                          SelectedItem="{Binding SelectedIcon}" 
                                          HorizontalAlignment="Stretch">
                                    <ComboBox.ItemTemplate>
                                        <DataTemplate>
                                            <StackPanel Orientation="Horizontal">
                                                <Image Source="{Binding Path, Converter={StaticResource StringToImageConverter}}" 
                                                       Width="24" Height="24" Margin="0,0,10,0" />
                                                <TextBlock Text="{Binding DisplayName, FallbackValue=Icon}" VerticalAlignment="Center" />
                                            </StackPanel>
                                        </DataTemplate>
                                    </ComboBox.ItemTemplate>
                                </ComboBox>
                                <Button Grid.Column="1" Content="Browse..." Command="{Binding BrowseCustomIconCommand}" 
                                        Margin="5,0,0,0" />
                            </Grid>
                        </StackPanel>

                        <!-- Icon Preview Grid -->
                        <StackPanel Classes="form-field">
                            <TextBlock Classes="form-label" Text="Available Icons" />
                            <Border Background="#1AFFFFFF" CornerRadius="5" Padding="10">
                                <ItemsControl ItemsSource="{Binding AvailableIcons}" MaxHeight="180">
                                    <ItemsControl.ItemsPanel>
                                        <ItemsPanelTemplate>
                                            <WrapPanel />
                                        </ItemsPanelTemplate>
                                    </ItemsControl.ItemsPanel>
                                    <ItemsControl.ItemTemplate>
                                        <DataTemplate>
                                            <!-- For Icon selection buttons -->
                                            <Button Width="60" Height="60" Margin="4" Padding="4" Background="#222222"
                                                    Command="{Binding $parent[Window].((vm:GameProfileSettingsViewModel)DataContext).SelectIconCommand}"
                                                    CommandParameter="{Binding}">
                                                <Image Source="{Binding Path, Converter={StaticResource StringToImageConverter}}"
                                                      Stretch="Uniform" Width="44" Height="44" />
                                            </Button>
                                        </DataTemplate>
                                    </ItemsControl.ItemTemplate>
                                </ItemsControl>
                            </Border>
                        </StackPanel>

                        <!-- Cover Image -->
                        <StackPanel Classes="form-field">
                            <TextBlock Classes="form-label" Text="Cover Image" />
                            <Grid ColumnDefinitions="*,Auto">
                                <ComboBox Grid.Column="0" 
                                          Name="CoverComboBox"
                                          ItemsSource="{Binding AvailableCovers}" 
                                          SelectedItem="{Binding SelectedCover}" 
                                          HorizontalAlignment="Stretch">
                                    <ComboBox.ItemTemplate>
                                        <DataTemplate>
                                            <StackPanel Orientation="Horizontal">
                                                <Image Source="{Binding Path, Converter={StaticResource StringToImageConverter}}" 
                                                       Width="24" Height="24" Margin="0,0,10,0" />
                                                <TextBlock Text="{Binding DisplayName, FallbackValue=Cover}" VerticalAlignment="Center" />
                                            </StackPanel>
                                        </DataTemplate>
                                    </ComboBox.ItemTemplate>
                                </ComboBox>
                                <Button Grid.Column="1" Content="Browse..." Command="{Binding BrowseCustomCoverCommand}" 
                                        Margin="5,0,0,0" />
                            </Grid>
                        </StackPanel>

                        <!-- Cover Preview Grid -->
                        <StackPanel Classes="form-field">
                            <TextBlock Classes="form-label" Text="Available Covers" />
                            <Border Background="#1AFFFFFF" CornerRadius="5" Padding="10">
                                <ItemsControl ItemsSource="{Binding AvailableCovers}" MaxHeight="220">
                                    <ItemsControl.ItemsPanel>
                                        <ItemsPanelTemplate>
                                            <WrapPanel />
                                        </ItemsPanelTemplate>
                                    </ItemsControl.ItemsPanel>
                                    <ItemsControl.ItemTemplate>
                                        <DataTemplate>
                                            <!-- For Cover selection buttons -->
                                            <Button Width="120" Height="70" Margin="4" Padding="2" Background="#222222"
                                                    Command="{Binding $parent[Window].((vm:GameProfileSettingsViewModel)DataContext).SelectCoverCommand}"
                                                    CommandParameter="{Binding}">
                                                <Image Source="{Binding Path, Converter={StaticResource StringToImageConverter}}"
                                                      Stretch="UniformToFill" Width="116" Height="66" />
                                            </Button>
                                        </DataTemplate>
                                    </ItemsControl.ItemTemplate>
                                </ItemsControl>
                            </Border>
                        </StackPanel>

                        <!-- Color -->
                        <StackPanel Classes="form-field">
                            <TextBlock Classes="form-label" Text="Profile Color" />
                            <Border Background="#1AFFFFFF" CornerRadius="5" Padding="10">
                                <StackPanel>
                                    <WrapPanel>
                                        <!-- Pre-defined color buttons with improved contrast and variety -->
                                        <Button Classes="color-button" Background="#D32F2F" 
                                                Command="{Binding SelectThemeColorCommand}" 
                                                CommandParameter="#D32F2F">
                                            <Panel Width="16" Height="16" />
                                        </Button>
                                        <Button Classes="color-button" Background="#C2185B" 
                                                Command="{Binding SelectThemeColorCommand}" 
                                                CommandParameter="#C2185B">
                                            <Panel Width="16" Height="16" />
                                        </Button>
                                        <Button Classes="color-button" Background="#7B1FA2" 
                                                Command="{Binding SelectThemeColorCommand}" 
                                                CommandParameter="#7B1FA2">
                                            <Panel Width="16" Height="16" />
                                        </Button>
                                        <Button Classes="color-button" Background="#512DA8" 
                                                Command="{Binding SelectThemeColorCommand}" 
                                                CommandParameter="#512DA8">
                                            <Panel Width="16" Height="16" />
                                        </Button>
                                        <Button Classes="color-button" Background="#303F9F" 
                                                Command="{Binding SelectThemeColorCommand}" 
                                                CommandParameter="#303F9F">
                                            <Panel Width="16" Height="16" />
                                        </Button>
                                        <Button Classes="color-button" Background="#1976D2" 
                                                Command="{Binding SelectThemeColorCommand}" 
                                                CommandParameter="#1976D2">
                                            <Panel Width="16" Height="16" />
                                        </Button>
                                        <Button Classes="color-button" Background="#0288D1" 
                                                Command="{Binding SelectThemeColorCommand}" 
                                                CommandParameter="#0288D1">
                                            <Panel Width="16" Height="16" />
                                        </Button>
                                        <Button Classes="color-button" Background="#0097A7" 
                                                Command="{Binding SelectThemeColorCommand}" 
                                                CommandParameter="#0097A7">
                                            <Panel Width="16" Height="16" />
                                        </Button>
                                        <Button Classes="color-button" Background="#00796B" 
                                                Command="{Binding SelectThemeColorCommand}" 
                                                CommandParameter="#00796B">
                                            <Panel Width="16" Height="16" />
                                        </Button>
                                        <Button Classes="color-button" Background="#388E3C" 
                                                Command="{Binding SelectThemeColorCommand}" 
                                                CommandParameter="#388E3C">
                                            <Panel Width="16" Height="16" />
                                        </Button>
                                        <Button Classes="color-button" Background="#689F38" 
                                                Command="{Binding SelectThemeColorCommand}" 
                                                CommandParameter="#689F38">
                                            <Panel Width="16" Height="16" />
                                        </Button>
                                        <Button Classes="color-button" Background="#AFB42B" 
                                                Command="{Binding SelectThemeColorCommand}" 
                                                CommandParameter="#AFB42B">
                                            <Panel Width="16" Height="16" />
                                        </Button>
                                        <Button Classes="color-button" Background="#FBC02D" 
                                                Command="{Binding SelectThemeColorCommand}" 
                                                CommandParameter="#FBC02D">
                                            <Panel Width="16" Height="16" />
                                        </Button>
                                        <Button Classes="color-button" Background="#FFA000" 
                                                Command="{Binding SelectThemeColorCommand}" 
                                                CommandParameter="#FFA000">
                                            <Panel Width="16" Height="16" />
                                        </Button>
                                        <Button Classes="color-button" Background="#E64A19" 
                                                Command="{Binding SelectThemeColorCommand}" 
                                                CommandParameter="#E64A19">
                                            <Panel Width="16" Height="16" />
                                        </Button>
                                        <Button Classes="color-button" Background="#5D4037" 
                                                Command="{Binding SelectThemeColorCommand}" 
                                                CommandParameter="#5D4037">
                                            <Panel Width="16" Height="16" />
                                        </Button>
                                        <Button Classes="color-button" Background="#616161" 
                                                Command="{Binding SelectThemeColorCommand}" 
                                                CommandParameter="#616161">
                                            <Panel Width="16" Height="16" />
                                        </Button>
                                        <Button Classes="color-button" Background="#455A64" 
                                                Command="{Binding SelectThemeColorCommand}" 
                                                CommandParameter="#455A64">
                                            <Panel Width="16" Height="16" />
                                        </Button>
                                        <Button Classes="color-button" Background="#212121" 
                                                Command="{Binding SelectThemeColorCommand}" 
                                                CommandParameter="#212121">
                                            <Panel Width="16" Height="16" />
                                        </Button>
                                        <Button Classes="color-button" Background="#263238" 
                                                Command="{Binding SelectThemeColorCommand}" 
                                                CommandParameter="#263238">
                                            <Panel Width="16" Height="16" />
                                        </Button>
                                        <!-- Special game-specific colors -->
                                        <Button Classes="color-button" Background="#BD5A0F" 
                                                Command="{Binding SelectThemeColorCommand}" 
                                                CommandParameter="#BD5A0F" 
                                                ToolTip.Tip="Generals Color">
                                            <Panel Width="16" Height="16" />
                                        </Button>
                                        <Button Classes="color-button" Background="#2D4963" 
                                                Command="{Binding SelectThemeColorCommand}" 
                                                CommandParameter="#2D4963" 
                                                ToolTip.Tip="Zero Hour Color">
                                            <Panel Width="16" Height="16" />
                                        </Button>
                                    </WrapPanel>
                                </StackPanel>
                            </Border>
                        </StackPanel>
                    </StackPanel>
                </ScrollViewer>
            </TabItem>

            <!-- Game Version Tab -->
            <TabItem Header="Game Version">
                <ScrollViewer>
                    <StackPanel Margin="0,10,0,0">
                        <!-- Version Selection -->
                        <StackPanel Classes="form-field">
                            <TextBlock Classes="form-label" Text="Game Client" />
                            <Grid ColumnDefinitions="*,Auto">
                                <ComboBox Grid.Column="0" 
                                          Name="VersionComboBox"
                                          ItemsSource="{Binding AvailableGameClients}" 
                                          SelectedItem="{Binding SelectedClient}" 
                                          HorizontalAlignment="Stretch">
                                    <ComboBox.ItemTemplate>
                                        <DataTemplate>
                                            <StackPanel Orientation="Horizontal">
                                                <TextBlock Text="{Binding Name}" FontWeight="SemiBold" />
                                                <TextBlock Text=" (" Opacity="0.7" />
                                                <TextBlock Text="{Binding SourceTypeName}" Opacity="0.7" />
                                                <TextBlock Text=")" Opacity="0.7" />
                                            </StackPanel>
                                        </DataTemplate>
                                    </ComboBox.ItemTemplate>
                                </ComboBox>
                                <Button Grid.Column="1" Content="Scan for Games" Margin="5,0,0,0" 
                                        Command="{Binding ScanForClientsCommand}" />
                            </Grid>
                        </StackPanel>

                        <!-- Client Details Card -->
                        <Border Classes="info-card" IsVisible="{Binding SelectedClient, Converter={StaticResource NotNullConverter}, FallbackValue=False}">
                            <StackPanel>
                                <TextBlock Text="Client Information" FontWeight="Bold" FontSize="15" Margin="0,0,0,10" />
                                
                                <!-- Basic Client Info -->
                                <StackPanel Classes="info-item">
                                    <TextBlock Classes="info-label" Text="Game Type:" />
                                    <TextBlock Text="{Binding SelectedClient.GameType, FallbackValue=Unknown}" />
                                </StackPanel>
                                
                                <StackPanel Classes="info-item">
                                    <TextBlock Classes="info-label" Text="Source:" />
                                    <TextBlock Text="{Binding SelectedClient.SourceTypeName, FallbackValue=Unknown}" />
                                </StackPanel>
                                
                                <StackPanel Classes="info-item">
                                    <TextBlock Classes="info-label" Text="Install Path:" />
                                    <TextBlock Text="{Binding SelectedClient.InstallPath}" TextWrapping="Wrap"
                                               MaxWidth="350" />
                                </StackPanel>
                                
                                <StackPanel Classes="info-item">
                                    <TextBlock Classes="info-label" Text="Size:" />
                                    <TextBlock Text="{Binding SelectedClient.FormattedSize, FallbackValue=Unknown}" />
                                </StackPanel>
                                
                                <StackPanel Classes="info-item" IsVisible="{Binding SelectedClient.BuildDate, Converter={StaticResource NotNullConverter}}">
                                    <TextBlock Classes="info-label" Text="Build Date:" />
                                    <TextBlock Text="{Binding SelectedClient.BuildDate, StringFormat={}{0:yyyy-MM-dd}, FallbackValue=Unknown}" />
                                </StackPanel>
                                
                                <!-- Use This Client Button -->
                                <Button Content="Use This Client" 
                                        Command="{Binding SelectClientCommand}"
                                        HorizontalAlignment="Left"
                                        Margin="0,15,0,0" />
                            </StackPanel>
                        </Border>

                        <!-- Executable Path Dropdown -->
                        <StackPanel Classes="form-field">
                            <TextBlock Classes="form-label" Text="Executable Path" />
                            <Grid ColumnDefinitions="*,Auto">
                                <ComboBox Grid.Column="0" 
                                         ItemsSource="{Binding AvailableExecutables}"
                                         SelectedItem="{Binding SelectedExecutable}"
                                         HorizontalAlignment="Stretch">
                                    <ComboBox.ItemTemplate>
                                        <DataTemplate>
                                            <TextBlock Text="{Binding DisplayName}" />
                                        </DataTemplate>
                                    </ComboBox.ItemTemplate>
                                </ComboBox>
                                <Button Grid.Column="1" Content="Browse..." 
                                        Command="{Binding BrowseExecutableCommand}" Margin="5,0,0,0" />
                            </Grid>
                            <!-- Validation indicator -->
                            <TextBlock Text="✓ Valid executable path" Foreground="#4CAF50" Margin="0,5,0,0"
                                       IsVisible="{Binding IsExecutableValid}" />
                            <TextBlock Text="✗ Invalid executable path" Foreground="#F44336" Margin="0,5,0,0"
                                       IsVisible="{Binding !IsExecutableValid}" />
                        </StackPanel>

                        <!-- Data Directory Dropdown -->
                        <StackPanel Classes="form-field">
                            <TextBlock Classes="form-label" Text="Data Path" />
                            <Grid ColumnDefinitions="*,Auto">
                                <ComboBox Grid.Column="0" 
                                         ItemsSource="{Binding AvailableDataPaths}"
                                         SelectedItem="{Binding SelectedDataPath}"
                                         HorizontalAlignment="Stretch">
                                    <ComboBox.ItemTemplate>
                                        <DataTemplate>
                                            <TextBlock Text="{Binding DisplayName}" />
                                        </DataTemplate>
                                    </ComboBox.ItemTemplate>
                                </ComboBox>
                                <Button Grid.Column="1" Content="Browse..." 
                                        Command="{Binding BrowseDataPathCommand}" Margin="5,0,0,0" />
                            </Grid>
                            <!-- Validation indicator -->
                            <TextBlock Text="✓ Valid data path" Foreground="#4CAF50" Margin="0,5,0,0"
                                       IsVisible="{Binding IsDataPathValid}" />
                            <TextBlock Text="✗ Invalid data path" Foreground="#F44336" Margin="0,5,0,0"
                                       IsVisible="{Binding !IsDataPathValid}" />
                            
                            <!-- Installation type badge for valid game data -->
                            <Border Background="#2D4963" CornerRadius="3" Padding="5,2" Margin="0,5,0,0"
                                    HorizontalAlignment="Left"
                                    IsVisible="{Binding SelectedClient.SourceType, Converter={StaticResource NotNullConverter}}">
                                <TextBlock Text="{Binding SelectedClient.SourceTypeName}" FontSize="11" Foreground="White" />
                            </Border>
                        </StackPanel>
                        
                        <!-- Validate Paths Button -->
                        <Button Content="Validate Paths" 
                                Command="{Binding ValidateProfileCommand}"
                                HorizontalAlignment="Left"
                                Margin="0,10,0,0" />
                    </StackPanel>
                </ScrollViewer>
            </TabItem>

            <!-- Advanced Tab -->
            <TabItem Header="Advanced">
                <ScrollViewer>
                    <StackPanel Margin="0,10,0,0">
                        <!-- Command Line Arguments -->
                        <StackPanel Classes="form-field">
                            <TextBlock Classes="form-label" Text="Command Line Arguments" />
                            <TextBox Text="{Binding CommandLineArguments}" 
                                     Watermark="Additional arguments to pass to the game" />
                        </StackPanel>

                        <!-- Run as Admin -->
                        <StackPanel Classes="form-field">
                            <CheckBox IsChecked="{Binding RunAsAdmin}" 
                                      Content="Run as administrator" />
                        </StackPanel>
                        
                        <!-- Test Launch Button -->
                        <Button Content="Test Launch" 
                                Command="{Binding TestLaunchCommand}"
                                HorizontalAlignment="Left"
                                IsEnabled="{Binding CanLaunchGame}"
                                Classes="accent" />
                                
                        <!-- Launch status indicator -->
                        <TextBlock Text="✓ Game is ready to launch" Foreground="#4CAF50" Margin="0,10,0,0"
                                   IsVisible="{Binding CanLaunchGame}" />
                        <TextBlock Text="✗ Game cannot be launched - invalid paths" Foreground="#F44336" Margin="0,10,0,0"
                                   IsVisible="{Binding !CanLaunchGame}" />                    </StackPanel>
                </ScrollViewer>
            </TabItem>

            <!-- Shortcut Tab -->
            <TabItem Header="Shortcut">
                <ScrollViewer>
                    <StackPanel Margin="0,10,0,0">
                        <!-- Shortcut Settings Section -->
                        <StackPanel Classes="form-field">
                            <TextBlock Classes="form-label" Text="Desktop Shortcut" />
                            <Border Background="#1AFFFFFF" CornerRadius="5" Padding="15" Margin="0,0,0,15">
                                <StackPanel>
                                    <TextBlock Text="Create a desktop shortcut for quick access to this game profile." 
                                               Margin="0,0,0,10" 
                                               FontSize="12" 
                                               Opacity="0.8" />
                                    
                                    <!-- Shortcut Save Location -->
                                    <StackPanel Classes="form-field">
                                        <TextBlock Classes="form-label" Text="Save Location" />
                                        <Grid ColumnDefinitions="*,Auto">
                                            <TextBox Grid.Column="0" 
                                                     Text="{Binding ShortcutPath}" 
                                                     IsReadOnly="True"
                                                     Watermark="Choose shortcut save location..." />
                                            <Button Grid.Column="1" 
                                                    Content="Browse..." 
                                                    Command="{Binding BrowseShortcutPathCommand}"
                                                    Margin="10,0,0,0" 
                                                    Width="100" />
                                        </Grid>
                                        
                                        <!-- Validation Status -->
                                        <TextBlock Text="✓ Valid save location" 
                                                   Foreground="#4CAF50" 
                                                   Margin="0,5,0,0"
                                                   FontSize="12"
                                                   IsVisible="{Binding IsShortcutPathValid}" />
                                        <TextBlock Text="⚠ Invalid save location" 
                                                   Foreground="#FF9800" 
                                                   Margin="0,5,0,0"
                                                   FontSize="12"
                                                   IsVisible="{Binding !IsShortcutPathValid}" />
                                    </StackPanel>

                                    <!-- Create Shortcut Button -->
                                    <Button Content="Create/Update Shortcut" 
                                            Command="{Binding CreateShortcutCommand}"
                                            IsEnabled="{Binding IsShortcutPathValid}"
                                            HorizontalAlignment="Left"
                                            Margin="0,10,0,0"
                                            Classes="accent" />
                                    
                                    <!-- Shortcut Status -->
                                    <TextBlock Text="{Binding ShortcutStatusMessage}" 
                                               Margin="0,10,0,0"
                                               FontSize="12"
                                               Opacity="0.8" />
                                </StackPanel>
                            </Border>
                        </StackPanel>                        <!-- Desktop Shortcut Section -->
                        <StackPanel Classes="form-field">
                            <TextBlock Classes="form-label" Text="Desktop Shortcut" />
                            <Border Background="#1AFFFFFF" CornerRadius="8" Padding="20" Margin="0,0,0,15">
                                <StackPanel>
                                    <!-- Header -->
                                    <Grid ColumnDefinitions="Auto,*,Auto" Margin="0,0,0,15">
                                        <PathIcon Grid.Column="0" 
                                                  Data="M5,17H19V7H5M10,16L6,12L7.41,10.58L10,13.17L16.59,6.58L18,8M19,3A2,2 0 0,1 21,5V19A2,2 0 0,1 19,21H5A2,2 0 0,1 3,19V5A2,2 0 0,1 5,3H19Z"
                                                  Width="24" Height="24" 
                                                  Foreground="{DynamicResource SystemAccentColor}"
                                                  VerticalAlignment="Center" />
                                        <StackPanel Grid.Column="1" Margin="12,0,0,0">
                                            <TextBlock Text="Quick Launch Shortcut" 
                                                       FontWeight="SemiBold" 
                                                       FontSize="14" />
                                            <TextBlock Text="Create a desktop shortcut to launch this profile directly" 
                                                       FontSize="12" 
                                                       Opacity="0.7" />
                                        </StackPanel>
                                        <Button Grid.Column="2"
                                                Content="Create Shortcut"
                                                Command="{Binding CreateShortcutCommand}"
                                                Classes="accent"
                                                HorizontalAlignment="Right" />
                                    </Grid>
                                    
                                    <!-- Shortcut Location -->
                                    <StackPanel Classes="form-field" Margin="0,0,0,15">
                                        <TextBlock Classes="form-label" Text="Save Location" />
                                        <Grid ColumnDefinitions="*,Auto">
                                            <TextBox Grid.Column="0" 
                                                     Text="{Binding ShortcutPath}" 
                                                     IsReadOnly="True"
                                                     Watermark="Choose shortcut save location..." 
                                                     Background="#0AFFFFFF" />
                                            <Button Grid.Column="1" 
                                                    Content="Browse" 
                                                    Command="{Binding BrowseShortcutPathCommand}"
                                                    Width="80"
                                                    Margin="10,0,0,0" />
                                        </Grid>
                                        <TextBlock Text="{Binding ShortcutStatusMessage}" 
                                                   Margin="0,5,0,0" 
                                                   FontSize="11" 
                                                   Foreground="{Binding IsShortcutPathValid, Converter={StaticResource BoolToStatusColorConverter}}" />
                                    </StackPanel>
                                    
                                    <!-- Shortcut Options -->
                                    <StackPanel Classes="form-field">
                                        <TextBlock Classes="form-label" Text="Shortcut Configuration" Margin="0,0,0,10" />
                                        
                                        <!-- Icon Options -->
                                        <Border Background="#0AFFFFFF" CornerRadius="4" Padding="12" Margin="0,0,0,10">
                                            <StackPanel>
                                                <CheckBox Content="Use profile icon for shortcut" 
                                                          IsChecked="{Binding UseProfileIcon}"
                                                          Margin="0,0,0,8" />
                                                <TextBlock Text="If disabled, GenHub's default icon will be used" 
                                                           FontSize="11" 
                                                           Opacity="0.6" 
                                                           Margin="24,0,0,0" />
                                            </StackPanel>
                                        </Border>
                                        
                                        <!-- Admin Options -->
                                        <Border Background="#0AFFFFFF" CornerRadius="4" Padding="12" Margin="0,0,0,10">
                                            <StackPanel>
                                                <CheckBox Content="Run as administrator" 
                                                          IsChecked="{Binding ShortcutRunAsAdmin}"
                                                          Margin="0,0,0,8" />
                                                <TextBlock Text="Required for some games or when GenHub needs elevated permissions" 
                                                           FontSize="11" 
                                                           Opacity="0.6" 
                                                           Margin="24,0,0,0" />
                                            </StackPanel>
                                        </Border>
                                        
                                        <!-- Description -->
                                        <StackPanel>
                                            <TextBlock Classes="form-label" Text="Shortcut Description" />
                                            <TextBox Text="{Binding ShortcutDescription}"
                                                     Watermark="Optional description for the shortcut..."
                                                     MaxLength="200"
                                                     Background="#0AFFFFFF" />
                                            <TextBlock Text="This description appears in the shortcut's tooltip" 
                                                       FontSize="11" 
                                                       Opacity="0.6" 
                                                       Margin="0,4,0,0" />
                                        </StackPanel>
                                    </StackPanel>
                                </StackPanel>
                            </Border>
                        </StackPanel>
                    </StackPanel>
                </ScrollViewer>
            </TabItem>
        </TabControl>

        <!-- Bottom buttons -->
        <Grid Grid.Row="2" ColumnDefinitions="*,Auto" Margin="20" VerticalAlignment="Bottom">
            <StackPanel Grid.Column="0" Orientation="Horizontal">
                <TextBlock Text="{Binding StatusMessage}" VerticalAlignment="Center" />
            </StackPanel>
            <StackPanel Grid.Column="1" Orientation="Horizontal" Spacing="10">
                <Button Content="Cancel" 
                        Command="{Binding ExecuteCancelCommand}"  
                        Width="100" />
                <Button Content="Save" 
                        Command="{Binding SaveCommand}" 
                        Classes="accent" 
                        Width="100" />
            </StackPanel>
        </Grid>

        <!-- Initializing overlay -->
        <Border x:Name="InitializingOverlay" Grid.RowSpan="3" 
                IsVisible="{Binding IsInitializing}"
                Background="#AA000000" 
                ZIndex="1001">
            <StackPanel VerticalAlignment="Center"
                        HorizontalAlignment="Center"
                        Spacing="15">
                <ProgressBar IsIndeterminate="True" 
                             Width="200"
                             Height="4"/>
                <TextBlock Text="Loading profile data..."
                           Foreground="White"
                           FontSize="16"
                           HorizontalAlignment="Center"/>
            </StackPanel>
        </Border>

        <!-- Error Panel -->
        <Border Grid.RowSpan="3"
                Background="#80000000"
                IsVisible="{Binding LoadingError}"
                ZIndex="1000">
            <StackPanel HorizontalAlignment="Center" VerticalAlignment="Center">
                <TextBlock Text="Failed to load settings" FontSize="18" Foreground="White" Margin="0,0,0,10" />
                <Button Content="Close" HorizontalAlignment="Center" Command="{Binding ExecuteCancelCommand}" />
            </StackPanel>
        </Border>
        
        <!-- Saving overlay -->
        <Border Grid.RowSpan="3"
                IsVisible="{Binding IsSaving}"
                Background="#80000000"
                ZIndex="1000">
            <StackPanel VerticalAlignment="Center"
                        HorizontalAlignment="Center"
                        Spacing="15">
                <ProgressBar IsIndeterminate="True" 
                             Width="200"
                             Height="4"/>
                <TextBlock Text="Saving profile..."
                          Foreground="White"
                          FontSize="16"
                          HorizontalAlignment="Center"/>
            </StackPanel>
        </Border>
    </Grid>
</Window>
